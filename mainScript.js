mapboxgl.accessToken = 'pk.eyJ1Ijoic3BlY3RvcnIiLCJhIjoiY2xvdWpxOW9jMGFoMTJsbHN0dWVzYXVpZSJ9.ww3zMgJwE6iwljwvPeoKpA';

const geojson = { "type": "FeatureCollection", "features": [{ "type": "Feature", "properties": { "name": "United States of America", "movieCount": 6616, "total": 6616, "Drama": 2693, "Crime": 1046, "History": 268, "War": 197, "Action": 1666, "Thriller": 1921, "Fantasy": 776, "Comedy": 2419, "Romance": 1104, "Adventure": 1218, "Western": 113, "Horror": 999, "Music": 211, "Science Fiction": 889, "Animation": 567, "Family": 879, "Mystery": 667, "TV Movie": 90 }, "geometry": { "type": "Point", "coordinates": [-95.712891, 37.09024] } }, { "type": "Feature", "properties": { "name": "India", "movieCount": 81, "total": 81, "Comedy": 22, "Drama": 46, "Romance": 14, "Family": 14, "Adventure": 26, "War": 3, "Action": 26, "Science Fiction": 11, "Crime": 7, "Mystery": 4, "Thriller": 24, "Fantasy": 13, "History": 8, "Horror": 3, "Animation": 8, "Western": 2 }, "geometry": { "type": "Point", "coordinates": [78.96288, 20.593684] } }, { "type": "Feature", "properties": { "name": "Japan", "movieCount": 367, "total": 367, "Animation": 179, "Family": 40, "Fantasy": 110, "Romance": 44, "Drama": 149, "War": 14, "Action": 172, "Adventure": 103, "History": 19, "Comedy": 49, "Science Fiction": 95, "Crime": 34, "Mystery": 29, "Thriller": 70, "Music": 3, "Horror": 62, "Western": 3, "TV Movie": 1 }, "geometry": { "type": "Point", "coordinates": [138.252924, 36.204824] } }, { "type": "Feature", "properties": { "name": "South Korea", "movieCount": 92, "total": 92, "Comedy": 15, "Thriller": 42, "Drama": 45, "Mystery": 14, "Action": 43, "Romance": 10, "Music": 1, "Fantasy": 13, "Adventure": 27, "Animation": 11, "TV Movie": 2, "History": 6, "Crime": 18, "War": 6, "Science Fiction": 11, "Horror": 17, "Family": 7, "Western": 2 }, "geometry": { "type": "Point", "coordinates": [127.766922, 35.907757] } }, { "type": "Feature", "properties": { "name": "United Kingdom", "movieCount": 1277, "total": 1277, "Drama": 671, "Action": 299, "Crime": 193, "Thriller": 422, "Adventure": 248, "Science Fiction": 145, "War": 79, "Animation": 45, "Family": 105, "Fantasy": 149, "History": 124, "Horror": 167, "Mystery": 143, "TV Movie": 6, "Comedy": 326, "Romance": 221, "Music": 35, "Western": 12 }, "geometry": { "type": "Point", "coordinates": [-3.435973, 55.378051] } }, { "type": "Feature", "properties": { "name": "New Zealand", "movieCount": 46, "total": 46, "Adventure": 15, "Fantasy": 11, "Action": 15, "Comedy": 14, "War": 5, "Drama": 19, "History": 3, "Horror": 13, "Science Fiction": 7, "Romance": 3, "Family": 3, "Thriller": 9, "Animation": 2, "Mystery": 2, "Western": 3, "Music": 1, "TV Movie": 1 }, "geometry": { "type": "Point", "coordinates": [174.885971, -40.900557] } }, { "type": "Feature", "properties": { "name": "Italy", "movieCount": 480, "total": 480, "Western": 10, "Comedy": 226, "Drama": 233, "Romance": 81, "Crime": 56, "Thriller": 75, "Music": 9, "War": 20, "Family": 13, "Fantasy": 24, "History": 32, "Adventure": 32, "Horror": 43, "Mystery": 39, "Animation": 2, "Action": 39, "Science Fiction": 15 }, "geometry": { "type": "Point", "coordinates": [12.56738, 41.87194] } }, { "type": "Feature", "properties": { "name": "Spain", "movieCount": 249, "total": 249, "Western": 7, "Animation": 11, "Family": 11, "Adventure": 31, "Comedy": 69, "Fantasy": 27, "Drama": 138, "Mystery": 36, "Thriller": 101, "Romance": 45, "War": 14, "Action": 27, "Horror": 44, "History": 17, "Science Fiction": 19, "Crime": 27, "Music": 1 }, "geometry": { "type": "Point", "coordinates": [-3.74922, 40.463667] } }, { "type": "Feature", "properties": { "name": "Germany", "movieCount": 551, "total": 551, "Western": 8, "Drama": 301, "Crime": 112, "War": 35, "Thriller": 201, "Science Fiction": 58, "History": 44, "Comedy": 142, "Horror": 70, "Fantasy": 60, "Romance": 81, "Action": 142, "Adventure": 79, "Animation": 11, "Mystery": 71, "Music": 8, "Family": 29 }, "geometry": { "type": "Point", "coordinates": [10.451526, 51.165691] } }, { "type": "Feature", "properties": { "name": "France", "movieCount": 1128, "total": 1128, "Drama": 617, "Romance": 206, "Crime": 170, "War": 45, "Action": 176, "Thriller": 279, "Comedy": 435, "Animation": 59, "Family": 85, "Adventure": 135, "Fantasy": 86, "TV Movie": 3, "Science Fiction": 67, "Mystery": 95, "History": 73, "Music": 17, "Horror": 99, "Western": 10 }, "geometry": { "type": "Point", "coordinates": [2.213749, 46.227638] } }, { "type": "Feature", "properties": { "name": "Brazil", "movieCount": 42, "total": 42, "Drama": 27, "Crime": 7, "Comedy": 16, "Fantasy": 5, "Romance": 8, "Animation": 3, "TV Movie": 2, "Action": 4, "Thriller": 8, "Mystery": 3, "Western": 1, "Horror": 2, "Family": 2, "Science Fiction": 3, "Adventure": 3, "History": 2, "Music": 1 }, "geometry": { "type": "Point", "coordinates": [-51.92528, -14.235004] } }, { "type": "Feature", "properties": { "name": "Mexico", "movieCount": 70, "total": 70, "Family": 5, "Drama": 38, "Comedy": 24, "Music": 1, "War": 4, "Crime": 11, "Fantasy": 6, "Animation": 2, "Adventure": 12, "Romance": 12, "Thriller": 19, "Action": 14, "Science Fiction": 4, "History": 4, "Mystery": 4, "Horror": 11, "Western": 5 }, "geometry": { "type": "Point", "coordinates": [-102.552784, 23.634501] } }, { "type": "Feature", "properties": { "name": "China", "movieCount": 149, "total": 149, "Animation": 16, "Fantasy": 31, "Action": 93, "Family": 17, "Adventure": 54, "Drama": 75, "History": 19, "War": 10, "Comedy": 30, "TV Movie": 1, "Romance": 15, "Thriller": 34, "Crime": 16, "Science Fiction": 26, "Mystery": 11, "Horror": 5, "Music": 2 }, "geometry": { "type": "Point", "coordinates": [104.195397, 35.86166] } }, { "type": "Feature", "properties": { "name": "Poland", "movieCount": 38, "total": 38, "Drama": 32, "War": 5, "Animation": 4, "Mystery": 8, "History": 6, "Romance": 7, "Crime": 2, "Action": 1, "Fantasy": 4, "Music": 1, "Comedy": 5, "Thriller": 9, "Horror": 4, "Adventure": 1, "Family": 1, "Science Fiction": 2 }, "geometry": { "type": "Point", "coordinates": [19.145136, 51.919438] } }, { "type": "Feature", "properties": { "name": "Colombia", "movieCount": 11, "total": 11, "Drama": 7, "Comedy": 2, "Adventure": 3, "Thriller": 6, "Mystery": 1, "Crime": 2, "Action": 3, "History": 1, "Science Fiction": 1, "Horror": 1 }, "geometry": { "type": "Point", "coordinates": [-74.297333, 4.570868] } }, { "type": "Feature", "properties": { "name": "Ecuador", "movieCount": 2, "total": 2, "Drama": 2, "Comedy": 1, "Thriller": 1, "Crime": 1 }, "geometry": { "type": "Point", "coordinates": [-78.183406, -1.831239] } }, { "type": "Feature", "properties": { "name": "Turkey", "movieCount": 15, "total": 15, "Drama": 13, "War": 2, "History": 3, "Music": 1, "Crime": 1, "Romance": 1, "Comedy": 3, "Thriller": 3, "Mystery": 1, "Action": 2 }, "geometry": { "type": "Point", "coordinates": [35.243322, 38.963745] } }, { "type": "Feature", "properties": { "name": "Canada", "movieCount": 534, "total": 534, "Drama": 212, "Crime": 72, "Thriller": 208, "TV Movie": 17, "Animation": 48, "Fantasy": 65, "Action": 128, "War": 13, "Mystery": 81, "Romance": 52, "Horror": 140, "Science Fiction": 111, "Family": 75, "Adventure": 97, "Comedy": 124, "History": 18, "Music": 15, "Western": 5 }, "geometry": { "type": "Point", "coordinates": [-106.346771, 56.130366] } }, { "type": "Feature", "properties": { "name": "Ireland", "movieCount": 91, "total": 91, "Animation": 9, "Family": 11, "Adventure": 12, "Fantasy": 14, "Drama": 53, "Thriller": 28, "War": 6, "Comedy": 28, "Romance": 18, "Music": 4, "History": 7, "Mystery": 16, "Action": 8, "Crime": 6, "Horror": 19, "Science Fiction": 6 }, "geometry": { "type": "Point", "coordinates": [-8.24389, 53.41291] } }, { "type": "Feature", "properties": { "name": "Luxembourg", "movieCount": 25, "total": 25, "Animation": 7, "Family": 5, "Adventure": 6, "Fantasy": 6, "War": 2, "Drama": 14, "Comedy": 5, "Thriller": 6, "Crime": 4, "Romance": 5, "History": 2, "Action": 5, "Science Fiction": 3, "Horror": 5, "Mystery": 1 }, "geometry": { "type": "Point", "coordinates": [6.129583, 49.815273] } }, { "type": "Feature", "properties": { "name": "Sweden", "movieCount": 95, "total": 95, "Drama": 73, "Fantasy": 10, "Romance": 14, "Crime": 20, "Comedy": 15, "Mystery": 14, "Thriller": 33, "Horror": 17, "Action": 11, "Science Fiction": 4, "History": 3, "Western": 1, "Adventure": 5, "Music": 2, "War": 1 }, "geometry": { "type": "Point", "coordinates": [18.643501, 60.128161] } }, { "type": "Feature", "properties": { "name": "United Arab Emirates", "movieCount": 24, "total": 24, "Drama": 14, "Romance": 1, "Comedy": 4, "Horror": 4, "Thriller": 12, "Adventure": 3, "History": 1, "Action": 8, "Science Fiction": 5, "Crime": 1, "Mystery": 3, "Family": 1 }, "geometry": { "type": "Point", "coordinates": [53.847818, 23.424076] } }, { "type": "Feature", "properties": { "name": "Australia", "movieCount": 187, "total": 187, "Drama": 77, "History": 10, "War": 4, "Animation": 19, "Comedy": 49, "Family": 32, "Adventure": 50, "Music": 2, "Action": 44, "Science Fiction": 27, "Romance": 27, "Thriller": 65, "Fantasy": 25, "Mystery": 21, "Crime": 17, "Horror": 43, "Western": 3 }, "geometry": { "type": "Point", "coordinates": [133.775136, -25.274398] } }, { "type": "Feature", "properties": { "name": "Hong Kong", "movieCount": 142, "total": 142, "Drama": 61, "Thriller": 48, "Crime": 31, "Fantasy": 19, "Action": 111, "Adventure": 50, "Romance": 15, "Comedy": 38, "Science Fiction": 18, "Animation": 5, "Music": 1, "Mystery": 6, "History": 17, "Western": 3, "War": 4, "Family": 10, "Horror": 5 }, "geometry": { "type": "Point", "coordinates": [114.109497, 22.396428] } }, { "type": "Feature", "properties": { "name": "Cyprus", "movieCount": 2, "total": 2, "Drama": 1, "Action": 1, "Science Fiction": 1, "Fantasy": 1 }, "geometry": { "type": "Point", "coordinates": [33.429859, 35.126413] } }, { "type": "Feature", "properties": { "name": "Lebanon", "movieCount": 3, "total": 3, "Drama": 3, "Crime": 1, "Adventure": 1, "Action": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [35.862285, 33.854721] } }, { "type": "Feature", "properties": { "name": "Qatar", "movieCount": 4, "total": 4, "Drama": 4, "Horror": 1, "War": 1 }, "geometry": { "type": "Point", "coordinates": [51.183884, 25.354826] } }, { "type": "Feature", "properties": { "name": "Puerto Rico", "movieCount": 8, "total": 8, "Drama": 2, "War": 1, "Action": 5, "Adventure": 2, "Thriller": 6, "Science Fiction": 1, "Crime": 3, "Mystery": 1, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [-66.590149, 18.220833] } }, { "type": "Feature", "properties": { "name": "Belgium", "movieCount": 200, "total": 200, "Drama": 117, "Family": 22, "Animation": 19, "Fantasy": 24, "Adventure": 27, "Comedy": 65, "Romance": 40, "Science Fiction": 14, "Thriller": 50, "History": 17, "Action": 27, "War": 10, "Crime": 20, "Mystery": 15, "Western": 3, "Horror": 21, "Music": 2 }, "geometry": { "type": "Point", "coordinates": [4.469936, 50.503887] } }, { "type": "Feature", "properties": { "name": "Denmark", "movieCount": 74, "total": 74, "Drama": 53, "Family": 8, "Animation": 8, "Fantasy": 5, "Crime": 21, "War": 3, "History": 8, "Thriller": 23, "Comedy": 16, "Romance": 7, "Mystery": 10, "Adventure": 10, "Action": 13, "Science Fiction": 3, "Horror": 7, "Western": 1, "Music": 1 }, "geometry": { "type": "Point", "coordinates": [9.501785, 56.26392] } }, { "type": "Feature", "properties": { "name": "Netherlands", "movieCount": 52, "total": 52, "Drama": 39, "Romance": 11, "Crime": 8, "Thriller": 11, "Comedy": 11, "War": 6, "History": 4, "Mystery": 5, "Action": 9, "Western": 1, "Horror": 8, "Family": 1, "Adventure": 6, "Fantasy": 4, "Music": 1, "Science Fiction": 1 }, "geometry": { "type": "Point", "coordinates": [5.291266, 52.132633] } }, { "type": "Feature", "properties": { "name": "Switzerland", "movieCount": 56, "total": 56, "Drama": 36, "Romance": 14, "Mystery": 8, "Animation": 1, "Comedy": 14, "Family": 2, "Adventure": 7, "History": 3, "Action": 12, "Thriller": 17, "Fantasy": 1, "War": 1, "Science Fiction": 6, "Crime": 4, "Horror": 5 }, "geometry": { "type": "Point", "coordinates": [8.227512, 46.818188] } }, { "type": "Feature", "properties": { "name": "Czech Republic", "movieCount": 47, "total": 47, "Comedy": 8, "War": 8, "Drama": 19, "Adventure": 15, "Action": 20, "Thriller": 17, "Mystery": 4, "Music": 2, "History": 9, "Romance": 3, "Crime": 5, "Science Fiction": 8, "Fantasy": 8, "Horror": 9, "Western": 1, "Family": 3 }, "geometry": { "type": "Point", "coordinates": [15.472962, 49.817492] } }, { "type": "Feature", "properties": { "name": "Argentina", "movieCount": 27, "total": 27, "Mystery": 3, "Thriller": 10, "Drama": 17, "History": 2, "Crime": 9, "Comedy": 8, "Adventure": 4, "Romance": 2, "Music": 1, "Animation": 1, "Horror": 2, "Western": 1 }, "geometry": { "type": "Point", "coordinates": [-63.616672, -38.416097] } }, { "type": "Feature", "properties": { "name": "Austria", "movieCount": 26, "total": 26, "Drama": 21, "Romance": 8, "History": 3, "War": 3, "Comedy": 7, "Crime": 3, "Mystery": 3, "Action": 4, "Thriller": 8, "Horror": 3, "Adventure": 2 }, "geometry": { "type": "Point", "coordinates": [14.550072, 47.516231] } }, { "type": "Feature", "properties": { "name": "Iran", "movieCount": 9, "total": 9, "Drama": 9, "Family": 1, "Crime": 1, "Mystery": 1, "Thriller": 1, "Comedy": 1, "Romance": 1 }, "geometry": { "type": "Point", "coordinates": [53.688046, 32.427908] } }, { "type": "Feature", "properties": { "name": "Malawi", "movieCount": 1, "total": 1, "Drama": 1, "History": 1, "Family": 1 }, "geometry": { "type": "Point", "coordinates": [34.301525, -13.254308] } }, { "type": "Feature", "properties": { "name": "Thailand", "movieCount": 17, "total": 17, "Drama": 7, "Crime": 7, "Thriller": 10, "Comedy": 1, "Action": 10, "Horror": 2, "Mystery": 1, "Adventure": 4, "Fantasy": 1, "Romance": 2, "History": 2, "War": 1 }, "geometry": { "type": "Point", "coordinates": [100.992541, 15.870032] } }, { "type": "Feature", "properties": { "name": "Taiwan", "movieCount": 15, "total": 15, "Drama": 10, "Western": 1, "Adventure": 7, "Action": 8, "Romance": 3, "History": 4, "War": 2, "Thriller": 3, "Horror": 2, "Comedy": 2 }, "geometry": { "type": "Point", "coordinates": [120.960515, 23.69781] } }, { "type": "Feature", "properties": { "name": "Algeria", "movieCount": 3, "total": 3, "Drama": 3, "War": 2, "History": 2, "Thriller": 1, "Crime": 1 }, "geometry": { "type": "Point", "coordinates": [1.659626, 28.033886] } }, { "type": "Feature", "properties": { "name": "Finland", "movieCount": 21, "total": 21, "Drama": 8, "Crime": 2, "Action": 6, "War": 1, "Fantasy": 5, "History": 2, "Comedy": 8, "Animation": 2, "Adventure": 4, "Family": 2, "Thriller": 4, "Horror": 4, "Mystery": 1, "Science Fiction": 2 }, "geometry": { "type": "Point", "coordinates": [25.748151, 61.92411] } }, { "type": "Feature", "properties": { "name": "Iceland", "movieCount": 14, "total": 14, "Drama": 9, "Crime": 2, "Romance": 4, "Adventure": 5, "Fantasy": 2, "Family": 2, "Thriller": 4, "Comedy": 3, "History": 3, "Action": 3, "Horror": 3, "Mystery": 1, "Science Fiction": 1 }, "geometry": { "type": "Point", "coordinates": [-19.020835, 64.963051] } }, { "type": "Feature", "properties": { "name": "Norway", "movieCount": 41, "total": 41, "Drama": 23, "Crime": 8, "Thriller": 19, "War": 2, "History": 4, "Comedy": 7, "Romance": 3, "Horror": 13, "Mystery": 9, "Fantasy": 7, "Action": 7, "Adventure": 3, "Music": 2 }, "geometry": { "type": "Point", "coordinates": [8.468946, 60.472024] } }, { "type": "Feature", "properties": { "name": "Dominican Republic", "movieCount": 3, "total": 3, "Romance": 1, "Thriller": 3, "Drama": 1, "Adventure": 1, "Horror": 1 }, "geometry": { "type": "Point", "coordinates": [-70.162651, 18.735693] } }, { "type": "Feature", "properties": { "name": "Bulgaria", "movieCount": 23, "total": 23, "Comedy": 3, "Drama": 8, "War": 4, "Action": 19, "Adventure": 8, "History": 2, "Crime": 6, "Thriller": 10, "Science Fiction": 2, "Fantasy": 2, "Horror": 2 }, "geometry": { "type": "Point", "coordinates": [25.48583, 42.733883] } }, { "type": "Feature", "properties": { "name": "Hungary", "movieCount": 32, "total": 32, "Comedy": 6, "Drama": 15, "War": 3, "History": 4, "Romance": 6, "Fantasy": 9, "Thriller": 14, "Action": 10, "Science Fiction": 8, "Adventure": 7, "Mystery": 2, "Crime": 2, "Horror": 5, "Music": 1, "Family": 2 }, "geometry": { "type": "Point", "coordinates": [19.503304, 47.162494] } }, { "type": "Feature", "properties": { "name": "Yugoslavia", "movieCount": 4, "total": 4, "Comedy": 3, "Drama": 2, "War": 2, "Romance": 1, "Crime": 2, "Fantasy": 1, "Action": 1, "Adventure": 1, "Science Fiction": 1 }, "geometry": { "type": "Point", "coordinates": [19.4667, 42.7833] } }, { "type": "Feature", "properties": { "name": "South Africa", "movieCount": 38, "total": 38, "Drama": 12, "History": 4, "War": 3, "Action": 20, "Adventure": 11, "Science Fiction": 11, "Thriller": 15, "Mystery": 3, "Family": 1, "Comedy": 6, "Crime": 4, "Romance": 1, "Horror": 7, "Fantasy": 5, "Western": 1 }, "geometry": { "type": "Point", "coordinates": [22.937506, -30.559482] } }, { "type": "Feature", "properties": { "name": "Greece", "movieCount": 14, "total": 14, "Comedy": 4, "Romance": 6, "Crime": 1, "Drama": 11, "History": 1, "Adventure": 1, "Science Fiction": 2, "Horror": 1 }, "geometry": { "type": "Point", "coordinates": [21.824312, 39.074208] } }, { "type": "Feature", "properties": { "name": "Belarus", "movieCount": 1, "total": 1, "War": 1, "Drama": 1 }, "geometry": { "type": "Point", "coordinates": [27.953389, 53.709807] } }, { "type": "Feature", "properties": { "name": "Russia", "movieCount": 37, "total": 37, "War": 6, "Drama": 19, "Action": 19, "Crime": 2, "Fantasy": 8, "History": 5, "Romance": 3, "Adventure": 11, "Animation": 1, "Comedy": 2, "Science Fiction": 9, "Thriller": 12, "Horror": 6, "Mystery": 3, "Family": 1 }, "geometry": { "type": "Point", "coordinates": [105.318756, 61.52401] } }, { "type": "Feature", "properties": { "name": "Estonia", "movieCount": 2, "total": 2, "Drama": 2, "War": 1 }, "geometry": { "type": "Point", "coordinates": [25.013607, 58.595272] } }, { "type": "Feature", "properties": { "name": "Georgia", "movieCount": 1, "total": 1, "Drama": 1, "War": 1 }, "geometry": { "type": "Point", "coordinates": [43.356892, 42.315407] } }, { "type": "Feature", "properties": { "name": "Venezuela", "movieCount": 2, "total": 2, "Drama": 1, "Adventure": 1, "Horror": 1 }, "geometry": { "type": "Point", "coordinates": [-66.58973, 6.42375] } }, { "type": "Feature", "properties": { "name": "Ukraine", "movieCount": 6, "total": 6, "War": 2, "Action": 2, "Drama": 4, "Romance": 1, "Animation": 1, "Adventure": 1, "Family": 1, "Fantasy": 1, "Thriller": 3, "Comedy": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [31.16558, 48.379433] } }, { "type": "Feature", "properties": { "name": "Bosnia and Herzegovina", "movieCount": 3, "total": 3, "War": 2, "Drama": 2, "History": 2, "Crime": 1, "Action": 1 }, "geometry": { "type": "Point", "coordinates": [17.679076, 43.915886] } }, { "type": "Feature", "properties": { "name": "Montenegro", "movieCount": 2, "total": 2, "War": 1, "Drama": 2, "History": 1, "Thriller": 1 }, "geometry": { "type": "Point", "coordinates": [19.37439, 42.708678] } }, { "type": "Feature", "properties": { "name": "Romania", "movieCount": 22, "total": 22, "War": 3, "Drama": 11, "History": 4, "Romance": 4, "Comedy": 3, "Science Fiction": 3, "Thriller": 10, "Mystery": 7, "Action": 2, "Music": 1, "Adventure": 1, "Western": 1, "Horror": 7, "Crime": 1, "Fantasy": 1 }, "geometry": { "type": "Point", "coordinates": [24.96676, 45.943161] } }, { "type": "Feature", "properties": { "name": "Indonesia", "movieCount": 8, "total": 8, "Action": 6, "Crime": 5, "Thriller": 6, "Horror": 1, "Drama": 1, "Fantasy": 1, "Science Fiction": 2, "Adventure": 1 }, "geometry": { "type": "Point", "coordinates": [113.921327, -0.789275] } }, { "type": "Feature", "properties": { "name": "Serbia", "movieCount": 7, "total": 7, "Drama": 3, "Action": 3, "War": 1, "Thriller": 5, "Horror": 3, "Crime": 2, "Mystery": 1 }, "geometry": { "type": "Point", "coordinates": [21.005859, 44.016521] } }, { "type": "Feature", "properties": { "name": "Peru", "movieCount": 7, "total": 7, "Drama": 4, "Adventure": 4, "History": 1, "Animation": 1, "Family": 1, "Fantasy": 1, "Action": 2, "Thriller": 3, "Horror": 1 }, "geometry": { "type": "Point", "coordinates": [-75.015152, -9.189967] } }, { "type": "Feature", "properties": { "name": "Ghana", "movieCount": 1, "total": 1, "Drama": 1, "War": 1 }, "geometry": { "type": "Point", "coordinates": [-1.023194, 7.946527] } }, { "type": "Feature", "properties": { "name": "Singapore", "movieCount": 6, "total": 6, "Thriller": 1, "History": 1, "Drama": 2, "Action": 3, "Adventure": 2, "Animation": 1, "Horror": 3, "Science Fiction": 1 }, "geometry": { "type": "Point", "coordinates": [103.819836, 1.352083] } }, { "type": "Feature", "properties": { "name": "Slovenia", "movieCount": 2, "total": 2, "Action": 1, "History": 1, "War": 1, "Adventure": 1, "Family": 1, "Fantasy": 1 }, "geometry": { "type": "Point", "coordinates": [14.995463, 46.151241] } }, { "type": "Feature", "properties": { "name": "Morocco", "movieCount": 14, "total": 14, "Comedy": 2, "Drama": 11, "War": 5, "Action": 6, "History": 5, "Adventure": 4, "Western": 1, "Thriller": 2, "Crime": 1, "Romance": 2, "Music": 1 }, "geometry": { "type": "Point", "coordinates": [-7.09262, 31.791702] } }, { "type": "Feature", "properties": { "name": "Chile", "movieCount": 9, "total": 9, "Drama": 6, "History": 2, "Horror": 3, "Thriller": 3, "Adventure": 1 }, "geometry": { "type": "Point", "coordinates": [-71.542969, -35.675147] } }, { "type": "Feature", "properties": { "name": "Cambodia", "movieCount": 1, "total": 1, "War": 1, "Drama": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [104.990963, 12.565679] } }, { "type": "Feature", "properties": { "name": "Kenya", "movieCount": 1, "total": 1, "Drama": 1 }, "geometry": { "type": "Point", "coordinates": [37.906193, -0.023559] } }, { "type": "Feature", "properties": { "name": "Malta", "movieCount": 7, "total": 7, "Drama": 5, "War": 2, "Action": 3, "History": 3, "Adventure": 3, "Horror": 1, "Science Fiction": 1, "Thriller": 1, "Romance": 1, "Family": 1, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [14.375416, 35.937496] } }, { "type": "Feature", "properties": { "name": "Croatia", "movieCount": 1, "total": 1, "Drama": 1, "Romance": 1, "War": 1 }, "geometry": { "type": "Point", "coordinates": [15.2, 45.1] } }, { "type": "Feature", "properties": { "name": "Kuwait", "movieCount": 1, "total": 1, "Adventure": 1, "Drama": 1, "Action": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [47.481766, 29.31166] } }, { "type": "Feature", "properties": { "name": "Libyan Arab Jamahiriya", "movieCount": 1, "total": 1, "Adventure": 1, "Drama": 1, "Action": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [17.2283, 26.3351] } }, { "type": "Feature", "properties": { "name": "Saudi Arabia", "movieCount": 2, "total": 2, "Adventure": 1, "Drama": 2, "Action": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [45.079162, 23.885942] } }, { "type": "Feature", "properties": { "name": "Jordan", "movieCount": 3, "total": 3, "Drama": 3, "Horror": 1, "War": 1 }, "geometry": { "type": "Point", "coordinates": [36.238414, 30.585164] } }, { "type": "Feature", "properties": { "name": "Botswana", "movieCount": 2, "total": 2, "Action": 2, "Comedy": 2 }, "geometry": { "type": "Point", "coordinates": [24.684866, -22.328474] } }, { "type": "Feature", "properties": { "name": "Lithuania", "movieCount": 6, "total": 6, "War": 1, "History": 1, "Drama": 3, "Crime": 3, "Science Fiction": 2, "Adventure": 1, "Thriller": 2, "Mystery": 1, "Action": 2, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [23.881275, 55.169438] } }, { "type": "Feature", "properties": { "name": "Panama", "movieCount": 3, "total": 3, "Science Fiction": 1, "Action": 1, "Adventure": 1, "War": 1, "History": 1, "Drama": 2 }, "geometry": { "type": "Point", "coordinates": [-80.782127, 8.537981] } }, { "type": "Feature", "properties": { "name": "Bolivia", "movieCount": 1, "total": 1, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [-63.588653, -16.290154] } }, { "type": "Feature", "properties": { "name": "Vietnam", "movieCount": 1, "total": 1, "Drama": 1, "Romance": 1 }, "geometry": { "type": "Point", "coordinates": [108.277199, 14.058324] } }, { "type": "Feature", "properties": { "name": "Macao", "movieCount": 1, "total": 1, "Drama": 1, "History": 1, "Action": 1 }, "geometry": { "type": "Point", "coordinates": [113.5439, 22.1987] } }, { "type": "Feature", "properties": { "name": "Portugal", "movieCount": 6, "total": 6, "Romance": 2, "Drama": 2, "Adventure": 2, "Comedy": 1, "Mystery": 2, "Thriller": 2, "Horror": 2, "Science Fiction": 1, "Fantasy": 1, "Action": 1 }, "geometry": { "type": "Point", "coordinates": [-8.224454, 39.399872] } }, { "type": "Feature", "properties": { "name": "Cuba", "movieCount": 1, "total": 1, "Comedy": 1, "Thriller": 1, "Music": 1 }, "geometry": { "type": "Point", "coordinates": [-77.781167, 21.521757] } }, { "type": "Feature", "properties": { "name": "Kazakhstan", "movieCount": 1, "total": 1, "History": 1, "Adventure": 1, "War": 1, "Action": 1 }, "geometry": { "type": "Point", "coordinates": [66.923684, 48.019573] } }, { "type": "Feature", "properties": { "name": "Guadaloupe", "movieCount": 1, "total": 1, "Thriller": 1, "Action": 1 }, "geometry": { "type": "Point", "coordinates": [-61.551, 16.265] } }, { "type": "Feature", "properties": { "name": "Myanmar", "movieCount": 1, "total": 1, "Drama": 1, "Romance": 1, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [95.956, 21.9162] } }, { "type": "Feature", "properties": { "name": "Uruguay", "movieCount": 1, "total": 1, "Drama": 1, "Adventure": 1 }, "geometry": { "type": "Point", "coordinates": [-55.765835, -32.522779] } }, { "type": "Feature", "properties": { "name": "Israel", "movieCount": 6, "total": 6, "Comedy": 1, "Crime": 1, "Thriller": 4, "Horror": 3, "War": 1, "Drama": 1, "Science Fiction": 2, "Animation": 1, "Action": 2, "Adventure": 1 }, "geometry": { "type": "Point", "coordinates": [34.851612, 31.046051] } }, { "type": "Feature", "properties": { "name": "Albania", "movieCount": 1, "total": 1, "Drama": 1 }, "geometry": { "type": "Point", "coordinates": [20.168331, 41.153332] } }, { "type": "Feature", "properties": { "name": "Slovakia", "movieCount": 2, "total": 2, "Fantasy": 1, "Action": 1, "Adventure": 1, "Drama": 1, "Music": 1, "Comedy": 1 }, "geometry": { "type": "Point", "coordinates": [19.699024, 48.669026] } }, { "type": "Feature", "properties": { "name": "Iraq", "movieCount": 1, "total": 1, "War": 1, "Action": 1, "Drama": 1 }, "geometry": { "type": "Point", "coordinates": [43.679291, 33.223191] } }, { "type": "Feature", "properties": { "name": "Guatemala", "movieCount": 1, "total": 1, "Thriller": 1, "Horror": 1, "Drama": 1 }, "geometry": { "type": "Point", "coordinates": [-90.230759, 15.783471] } }, { "type": "Feature", "properties": { "name": "Liechtenstein", "movieCount": 1, "total": 1, "Drama": 1, "History": 1 }, "geometry": { "type": "Point", "coordinates": [9.555373, 47.166] } }, { "type": "Feature", "properties": { "name": "Malaysia", "movieCount": 1, "total": 1, "Horror": 1, "Science Fiction": 1, "Mystery": 1, "Thriller": 1 }, "geometry": { "type": "Point", "coordinates": [101.975766, 4.210484] } }, { "type": "Feature", "properties": { "name": "Bahamas", "movieCount": 2, "total": 2, "Comedy": 1, "Science Fiction": 1, "Adventure": 1, "Crime": 1, "Drama": 1, "Thriller": 1 }, "geometry": { "type": "Point", "coordinates": [-77.39628, 25.03428] } }, { "type": "Feature", "properties": { "name": "Aruba", "movieCount": 1, "total": 1, "Action": 1, "Crime": 1, "Thriller": 1 }, "geometry": { "type": "Point", "coordinates": [-69.968338, 12.52111] } }] }

const geojson2 = { "type": "FeatureCollection", "features": [{ "type": "Feature", "properties": { "name": "United States of America", "movieCount": 6616, "total": 6616, "Drama": 40.7, "Crime": 15.81, "History": 4.05, "War": 2.98, "Action": 25.18, "Thriller": 29.04, "Fantasy": 11.73, "Comedy": 36.56, "Romance": 16.69, "Adventure": 18.41, "Western": 1.71, "Horror": 15.1, "Music": 3.19, "Science Fiction": 13.44, "Animation": 8.57, "Family": 13.29, "Mystery": 10.08, "TV Movie": 1.36 }, "geometry": { "type": "Point", "coordinates": [-95.712891, 37.09024] } }, { "type": "Feature", "properties": { "name": "India", "movieCount": 81, "total": 81, "Comedy": 27.16, "Drama": 56.79, "Romance": 17.28, "Family": 17.28, "Adventure": 32.1, "War": 3.7, "Action": 32.1, "Science Fiction": 13.58, "Crime": 8.64, "Mystery": 4.94, "Thriller": 29.63, "Fantasy": 16.05, "History": 9.88, "Horror": 3.7, "Animation": 9.88, "Western": 2.47 }, "geometry": { "type": "Point", "coordinates": [78.96288, 20.593684] } }, { "type": "Feature", "properties": { "name": "Japan", "movieCount": 367, "total": 367, "Animation": 48.77, "Family": 10.9, "Fantasy": 29.97, "Romance": 11.99, "Drama": 40.6, "War": 3.81, "Action": 46.87, "Adventure": 28.07, "History": 5.18, "Comedy": 13.35, "Science Fiction": 25.89, "Crime": 9.26, "Mystery": 7.9, "Thriller": 19.07, "Music": 0.82, "Horror": 16.89, "Western": 0.82, "TV Movie": 0.27 }, "geometry": { "type": "Point", "coordinates": [138.252924, 36.204824] } }, { "type": "Feature", "properties": { "name": "South Korea", "movieCount": 92, "total": 92, "Comedy": 16.3, "Thriller": 45.65, "Drama": 48.91, "Mystery": 15.22, "Action": 46.74, "Romance": 10.87, "Music": 1.09, "Fantasy": 14.13, "Adventure": 29.35, "Animation": 11.96, "TV Movie": 2.17, "History": 6.52, "Crime": 19.57, "War": 6.52, "Science Fiction": 11.96, "Horror": 18.48, "Family": 7.61, "Western": 2.17 }, "geometry": { "type": "Point", "coordinates": [127.766922, 35.907757] } }, { "type": "Feature", "properties": { "name": "United Kingdom", "movieCount": 1277, "total": 1277, "Drama": 52.55, "Action": 23.41, "Crime": 15.11, "Thriller": 33.05, "Adventure": 19.42, "Science Fiction": 11.35, "War": 6.19, "Animation": 3.52, "Family": 8.22, "Fantasy": 11.67, "History": 9.71, "Horror": 13.08, "Mystery": 11.2, "TV Movie": 0.47, "Comedy": 25.53, "Romance": 17.31, "Music": 2.74, "Western": 0.94 }, "geometry": { "type": "Point", "coordinates": [-3.435973, 55.378051] } }, { "type": "Feature", "properties": { "name": "New Zealand", "movieCount": 46, "total": 46, "Adventure": 32.61, "Fantasy": 23.91, "Action": 32.61, "Comedy": 30.43, "War": 10.87, "Drama": 41.3, "History": 6.52, "Horror": 28.26, "Science Fiction": 15.22, "Romance": 6.52, "Family": 6.52, "Thriller": 19.57, "Animation": 4.35, "Mystery": 4.35, "Western": 6.52, "Music": 2.17, "TV Movie": 2.17 }, "geometry": { "type": "Point", "coordinates": [174.885971, -40.900557] } }, { "type": "Feature", "properties": { "name": "Italy", "movieCount": 480, "total": 480, "Western": 2.08, "Comedy": 47.08, "Drama": 48.54, "Romance": 16.88, "Crime": 11.67, "Thriller": 15.62, "Music": 1.88, "War": 4.17, "Family": 2.71, "Fantasy": 5.0, "History": 6.67, "Adventure": 6.67, "Horror": 8.96, "Mystery": 8.12, "Animation": 0.42, "Action": 8.12, "Science Fiction": 3.12 }, "geometry": { "type": "Point", "coordinates": [12.56738, 41.87194] } }, { "type": "Feature", "properties": { "name": "Spain", "movieCount": 249, "total": 249, "Western": 2.81, "Animation": 4.42, "Family": 4.42, "Adventure": 12.45, "Comedy": 27.71, "Fantasy": 10.84, "Drama": 55.42, "Mystery": 14.46, "Thriller": 40.56, "Romance": 18.07, "War": 5.62, "Action": 10.84, "Horror": 17.67, "History": 6.83, "Science Fiction": 7.63, "Crime": 10.84, "Music": 0.4 }, "geometry": { "type": "Point", "coordinates": [-3.74922, 40.463667] } }, { "type": "Feature", "properties": { "name": "Germany", "movieCount": 551, "total": 551, "Western": 1.45, "Drama": 54.63, "Crime": 20.33, "War": 6.35, "Thriller": 36.48, "Science Fiction": 10.53, "History": 7.99, "Comedy": 25.77, "Horror": 12.7, "Fantasy": 10.89, "Romance": 14.7, "Action": 25.77, "Adventure": 14.34, "Animation": 2.0, "Mystery": 12.89, "Music": 1.45, "Family": 5.26 }, "geometry": { "type": "Point", "coordinates": [10.451526, 51.165691] } }, { "type": "Feature", "properties": { "name": "France", "movieCount": 1128, "total": 1128, "Drama": 54.7, "Romance": 18.26, "Crime": 15.07, "War": 3.99, "Action": 15.6, "Thriller": 24.73, "Comedy": 38.56, "Animation": 5.23, "Family": 7.54, "Adventure": 11.97, "Fantasy": 7.62, "TV Movie": 0.27, "Science Fiction": 5.94, "Mystery": 8.42, "History": 6.47, "Music": 1.51, "Horror": 8.78, "Western": 0.89 }, "geometry": { "type": "Point", "coordinates": [2.213749, 46.227638] } }, { "type": "Feature", "properties": { "name": "Brazil", "movieCount": 42, "total": 42, "Drama": 64.29, "Crime": 16.67, "Comedy": 38.1, "Fantasy": 11.9, "Romance": 19.05, "Animation": 7.14, "TV Movie": 4.76, "Action": 9.52, "Thriller": 19.05, "Mystery": 7.14, "Western": 2.38, "Horror": 4.76, "Family": 4.76, "Science Fiction": 7.14, "Adventure": 7.14, "History": 4.76, "Music": 2.38 }, "geometry": { "type": "Point", "coordinates": [-51.92528, -14.235004] } }, { "type": "Feature", "properties": { "name": "Mexico", "movieCount": 70, "total": 70, "Family": 7.14, "Drama": 54.29, "Comedy": 34.29, "Music": 1.43, "War": 5.71, "Crime": 15.71, "Fantasy": 8.57, "Animation": 2.86, "Adventure": 17.14, "Romance": 17.14, "Thriller": 27.14, "Action": 20.0, "Science Fiction": 5.71, "History": 5.71, "Mystery": 5.71, "Horror": 15.71, "Western": 7.14 }, "geometry": { "type": "Point", "coordinates": [-102.552784, 23.634501] } }, { "type": "Feature", "properties": { "name": "China", "movieCount": 149, "total": 149, "Animation": 10.74, "Fantasy": 20.81, "Action": 62.42, "Family": 11.41, "Adventure": 36.24, "Drama": 50.34, "History": 12.75, "War": 6.71, "Comedy": 20.13, "TV Movie": 0.67, "Romance": 10.07, "Thriller": 22.82, "Crime": 10.74, "Science Fiction": 17.45, "Mystery": 7.38, "Horror": 3.36, "Music": 1.34 }, "geometry": { "type": "Point", "coordinates": [104.195397, 35.86166] } }, { "type": "Feature", "properties": { "name": "Poland", "movieCount": 38, "total": 38, "Drama": 84.21, "War": 13.16, "Animation": 10.53, "Mystery": 21.05, "History": 15.79, "Romance": 18.42, "Crime": 5.26, "Action": 2.63, "Fantasy": 10.53, "Music": 2.63, "Comedy": 13.16, "Thriller": 23.68, "Horror": 10.53, "Adventure": 2.63, "Family": 2.63, "Science Fiction": 5.26 }, "geometry": { "type": "Point", "coordinates": [19.145136, 51.919438] } }, { "type": "Feature", "properties": { "name": "Colombia", "movieCount": 11, "total": 11, "Drama": 63.64, "Comedy": 18.18, "Adventure": 27.27, "Thriller": 54.55, "Mystery": 9.09, "Crime": 18.18, "Action": 27.27, "History": 9.09, "Science Fiction": 9.09, "Horror": 9.09 }, "geometry": { "type": "Point", "coordinates": [-74.297333, 4.570868] } }, { "type": "Feature", "properties": { "name": "Ecuador", "movieCount": 2, "total": 2, "Drama": 100.0, "Comedy": 50.0, "Thriller": 50.0, "Crime": 50.0 }, "geometry": { "type": "Point", "coordinates": [-78.183406, -1.831239] } }, { "type": "Feature", "properties": { "name": "Turkey", "movieCount": 15, "total": 15, "Drama": 86.67, "War": 13.33, "History": 20.0, "Music": 6.67, "Crime": 6.67, "Romance": 6.67, "Comedy": 20.0, "Thriller": 20.0, "Mystery": 6.67, "Action": 13.33 }, "geometry": { "type": "Point", "coordinates": [35.243322, 38.963745] } }, { "type": "Feature", "properties": { "name": "Canada", "movieCount": 534, "total": 534, "Drama": 39.7, "Crime": 13.48, "Thriller": 38.95, "TV Movie": 3.18, "Animation": 8.99, "Fantasy": 12.17, "Action": 23.97, "War": 2.43, "Mystery": 15.17, "Romance": 9.74, "Horror": 26.22, "Science Fiction": 20.79, "Family": 14.04, "Adventure": 18.16, "Comedy": 23.22, "History": 3.37, "Music": 2.81, "Western": 0.94 }, "geometry": { "type": "Point", "coordinates": [-106.346771, 56.130366] } }, { "type": "Feature", "properties": { "name": "Ireland", "movieCount": 91, "total": 91, "Animation": 9.89, "Family": 12.09, "Adventure": 13.19, "Fantasy": 15.38, "Drama": 58.24, "Thriller": 30.77, "War": 6.59, "Comedy": 30.77, "Romance": 19.78, "Music": 4.4, "History": 7.69, "Mystery": 17.58, "Action": 8.79, "Crime": 6.59, "Horror": 20.88, "Science Fiction": 6.59 }, "geometry": { "type": "Point", "coordinates": [-8.24389, 53.41291] } }, { "type": "Feature", "properties": { "name": "Luxembourg", "movieCount": 25, "total": 25, "Animation": 28.0, "Family": 20.0, "Adventure": 24.0, "Fantasy": 24.0, "War": 8.0, "Drama": 56.0, "Comedy": 20.0, "Thriller": 24.0, "Crime": 16.0, "Romance": 20.0, "History": 8.0, "Action": 20.0, "Science Fiction": 12.0, "Horror": 20.0, "Mystery": 4.0 }, "geometry": { "type": "Point", "coordinates": [6.129583, 49.815273] } }, { "type": "Feature", "properties": { "name": "Sweden", "movieCount": 95, "total": 95, "Drama": 76.84, "Fantasy": 10.53, "Romance": 14.74, "Crime": 21.05, "Comedy": 15.79, "Mystery": 14.74, "Thriller": 34.74, "Horror": 17.89, "Action": 11.58, "Science Fiction": 4.21, "History": 3.16, "Western": 1.05, "Adventure": 5.26, "Music": 2.11, "War": 1.05 }, "geometry": { "type": "Point", "coordinates": [18.643501, 60.128161] } }, { "type": "Feature", "properties": { "name": "United Arab Emirates", "movieCount": 24, "total": 24, "Drama": 58.33, "Romance": 4.17, "Comedy": 16.67, "Horror": 16.67, "Thriller": 50.0, "Adventure": 12.5, "History": 4.17, "Action": 33.33, "Science Fiction": 20.83, "Crime": 4.17, "Mystery": 12.5, "Family": 4.17 }, "geometry": { "type": "Point", "coordinates": [53.847818, 23.424076] } }, { "type": "Feature", "properties": { "name": "Australia", "movieCount": 187, "total": 187, "Drama": 41.18, "History": 5.35, "War": 2.14, "Animation": 10.16, "Comedy": 26.2, "Family": 17.11, "Adventure": 26.74, "Music": 1.07, "Action": 23.53, "Science Fiction": 14.44, "Romance": 14.44, "Thriller": 34.76, "Fantasy": 13.37, "Mystery": 11.23, "Crime": 9.09, "Horror": 22.99, "Western": 1.6 }, "geometry": { "type": "Point", "coordinates": [133.775136, -25.274398] } }, { "type": "Feature", "properties": { "name": "Hong Kong", "movieCount": 142, "total": 142, "Drama": 42.96, "Thriller": 33.8, "Crime": 21.83, "Fantasy": 13.38, "Action": 78.17, "Adventure": 35.21, "Romance": 10.56, "Comedy": 26.76, "Science Fiction": 12.68, "Animation": 3.52, "Music": 0.7, "Mystery": 4.23, "History": 11.97, "Western": 2.11, "War": 2.82, "Family": 7.04, "Horror": 3.52 }, "geometry": { "type": "Point", "coordinates": [114.109497, 22.396428] } }, { "type": "Feature", "properties": { "name": "Cyprus", "movieCount": 2, "total": 2, "Drama": 50.0, "Action": 50.0, "Science Fiction": 50.0, "Fantasy": 50.0 }, "geometry": { "type": "Point", "coordinates": [33.429859, 35.126413] } }, { "type": "Feature", "properties": { "name": "Lebanon", "movieCount": 3, "total": 3, "Drama": 100.0, "Crime": 33.33, "Adventure": 33.33, "Action": 33.33, "History": 33.33 }, "geometry": { "type": "Point", "coordinates": [35.862285, 33.854721] } }, { "type": "Feature", "properties": { "name": "Qatar", "movieCount": 4, "total": 4, "Drama": 100.0, "Horror": 25.0, "War": 25.0 }, "geometry": { "type": "Point", "coordinates": [51.183884, 25.354826] } }, { "type": "Feature", "properties": { "name": "Puerto Rico", "movieCount": 8, "total": 8, "Drama": 25.0, "War": 12.5, "Action": 62.5, "Adventure": 25.0, "Thriller": 75.0, "Science Fiction": 12.5, "Crime": 37.5, "Mystery": 12.5, "Comedy": 12.5 }, "geometry": { "type": "Point", "coordinates": [-66.590149, 18.220833] } }, { "type": "Feature", "properties": { "name": "Belgium", "movieCount": 200, "total": 200, "Drama": 58.5, "Family": 11.0, "Animation": 9.5, "Fantasy": 12.0, "Adventure": 13.5, "Comedy": 32.5, "Romance": 20.0, "Science Fiction": 7.0, "Thriller": 25.0, "History": 8.5, "Action": 13.5, "War": 5.0, "Crime": 10.0, "Mystery": 7.5, "Western": 1.5, "Horror": 10.5, "Music": 1.0 }, "geometry": { "type": "Point", "coordinates": [4.469936, 50.503887] } }, { "type": "Feature", "properties": { "name": "Denmark", "movieCount": 74, "total": 74, "Drama": 71.62, "Family": 10.81, "Animation": 10.81, "Fantasy": 6.76, "Crime": 28.38, "War": 4.05, "History": 10.81, "Thriller": 31.08, "Comedy": 21.62, "Romance": 9.46, "Mystery": 13.51, "Adventure": 13.51, "Action": 17.57, "Science Fiction": 4.05, "Horror": 9.46, "Western": 1.35, "Music": 1.35 }, "geometry": { "type": "Point", "coordinates": [9.501785, 56.26392] } }, { "type": "Feature", "properties": { "name": "Netherlands", "movieCount": 52, "total": 52, "Drama": 75.0, "Romance": 21.15, "Crime": 15.38, "Thriller": 21.15, "Comedy": 21.15, "War": 11.54, "History": 7.69, "Mystery": 9.62, "Action": 17.31, "Western": 1.92, "Horror": 15.38, "Family": 1.92, "Adventure": 11.54, "Fantasy": 7.69, "Music": 1.92, "Science Fiction": 1.92 }, "geometry": { "type": "Point", "coordinates": [5.291266, 52.132633] } }, { "type": "Feature", "properties": { "name": "Switzerland", "movieCount": 56, "total": 56, "Drama": 64.29, "Romance": 25.0, "Mystery": 14.29, "Animation": 1.79, "Comedy": 25.0, "Family": 3.57, "Adventure": 12.5, "History": 5.36, "Action": 21.43, "Thriller": 30.36, "Fantasy": 1.79, "War": 1.79, "Science Fiction": 10.71, "Crime": 7.14, "Horror": 8.93 }, "geometry": { "type": "Point", "coordinates": [8.227512, 46.818188] } }, { "type": "Feature", "properties": { "name": "Czech Republic", "movieCount": 47, "total": 47, "Comedy": 17.02, "War": 17.02, "Drama": 40.43, "Adventure": 31.91, "Action": 42.55, "Thriller": 36.17, "Mystery": 8.51, "Music": 4.26, "History": 19.15, "Romance": 6.38, "Crime": 10.64, "Science Fiction": 17.02, "Fantasy": 17.02, "Horror": 19.15, "Western": 2.13, "Family": 6.38 }, "geometry": { "type": "Point", "coordinates": [15.472962, 49.817492] } }, { "type": "Feature", "properties": { "name": "Argentina", "movieCount": 27, "total": 27, "Mystery": 11.11, "Thriller": 37.04, "Drama": 62.96, "History": 7.41, "Crime": 33.33, "Comedy": 29.63, "Adventure": 14.81, "Romance": 7.41, "Music": 3.7, "Animation": 3.7, "Horror": 7.41, "Western": 3.7 }, "geometry": { "type": "Point", "coordinates": [-63.616672, -38.416097] } }, { "type": "Feature", "properties": { "name": "Austria", "movieCount": 26, "total": 26, "Drama": 80.77, "Romance": 30.77, "History": 11.54, "War": 11.54, "Comedy": 26.92, "Crime": 11.54, "Mystery": 11.54, "Action": 15.38, "Thriller": 30.77, "Horror": 11.54, "Adventure": 7.69 }, "geometry": { "type": "Point", "coordinates": [14.550072, 47.516231] } }, { "type": "Feature", "properties": { "name": "Iran", "movieCount": 9, "total": 9, "Drama": 100.0, "Family": 11.11, "Crime": 11.11, "Mystery": 11.11, "Thriller": 11.11, "Comedy": 11.11, "Romance": 11.11 }, "geometry": { "type": "Point", "coordinates": [53.688046, 32.427908] } }, { "type": "Feature", "properties": { "name": "Malawi", "movieCount": 1, "total": 1, "Drama": 100.0, "History": 100.0, "Family": 100.0 }, "geometry": { "type": "Point", "coordinates": [34.301525, -13.254308] } }, { "type": "Feature", "properties": { "name": "Thailand", "movieCount": 17, "total": 17, "Drama": 41.18, "Crime": 41.18, "Thriller": 58.82, "Comedy": 5.88, "Action": 58.82, "Horror": 11.76, "Mystery": 5.88, "Adventure": 23.53, "Fantasy": 5.88, "Romance": 11.76, "History": 11.76, "War": 5.88 }, "geometry": { "type": "Point", "coordinates": [100.992541, 15.870032] } }, { "type": "Feature", "properties": { "name": "Taiwan", "movieCount": 15, "total": 15, "Drama": 66.67, "Western": 6.67, "Adventure": 46.67, "Action": 53.33, "Romance": 20.0, "History": 26.67, "War": 13.33, "Thriller": 20.0, "Horror": 13.33, "Comedy": 13.33 }, "geometry": { "type": "Point", "coordinates": [120.960515, 23.69781] } }, { "type": "Feature", "properties": { "name": "Algeria", "movieCount": 3, "total": 3, "Drama": 100.0, "War": 66.67, "History": 66.67, "Thriller": 33.33, "Crime": 33.33 }, "geometry": { "type": "Point", "coordinates": [1.659626, 28.033886] } }, { "type": "Feature", "properties": { "name": "Finland", "movieCount": 21, "total": 21, "Drama": 38.1, "Crime": 9.52, "Action": 28.57, "War": 4.76, "Fantasy": 23.81, "History": 9.52, "Comedy": 38.1, "Animation": 9.52, "Adventure": 19.05, "Family": 9.52, "Thriller": 19.05, "Horror": 19.05, "Mystery": 4.76, "Science Fiction": 9.52 }, "geometry": { "type": "Point", "coordinates": [25.748151, 61.92411] } }, { "type": "Feature", "properties": { "name": "Iceland", "movieCount": 14, "total": 14, "Drama": 64.29, "Crime": 14.29, "Romance": 28.57, "Adventure": 35.71, "Fantasy": 14.29, "Family": 14.29, "Thriller": 28.57, "Comedy": 21.43, "History": 21.43, "Action": 21.43, "Horror": 21.43, "Mystery": 7.14, "Science Fiction": 7.14 }, "geometry": { "type": "Point", "coordinates": [-19.020835, 64.963051] } }, { "type": "Feature", "properties": { "name": "Norway", "movieCount": 41, "total": 41, "Drama": 56.1, "Crime": 19.51, "Thriller": 46.34, "War": 4.88, "History": 9.76, "Comedy": 17.07, "Romance": 7.32, "Horror": 31.71, "Mystery": 21.95, "Fantasy": 17.07, "Action": 17.07, "Adventure": 7.32, "Music": 4.88 }, "geometry": { "type": "Point", "coordinates": [8.468946, 60.472024] } }, { "type": "Feature", "properties": { "name": "Dominican Republic", "movieCount": 3, "total": 3, "Romance": 33.33, "Thriller": 100.0, "Drama": 33.33, "Adventure": 33.33, "Horror": 33.33 }, "geometry": { "type": "Point", "coordinates": [-70.162651, 18.735693] } }, { "type": "Feature", "properties": { "name": "Bulgaria", "movieCount": 23, "total": 23, "Comedy": 13.04, "Drama": 34.78, "War": 17.39, "Action": 82.61, "Adventure": 34.78, "History": 8.7, "Crime": 26.09, "Thriller": 43.48, "Science Fiction": 8.7, "Fantasy": 8.7, "Horror": 8.7 }, "geometry": { "type": "Point", "coordinates": [25.48583, 42.733883] } }, { "type": "Feature", "properties": { "name": "Hungary", "movieCount": 32, "total": 32, "Comedy": 18.75, "Drama": 46.88, "War": 9.38, "History": 12.5, "Romance": 18.75, "Fantasy": 28.12, "Thriller": 43.75, "Action": 31.25, "Science Fiction": 25.0, "Adventure": 21.88, "Mystery": 6.25, "Crime": 6.25, "Horror": 15.62, "Music": 3.12, "Family": 6.25 }, "geometry": { "type": "Point", "coordinates": [19.503304, 47.162494] } }, { "type": "Feature", "properties": { "name": "Yugoslavia", "movieCount": 4, "total": 4, "Comedy": 75.0, "Drama": 50.0, "War": 50.0, "Romance": 25.0, "Crime": 50.0, "Fantasy": 25.0, "Action": 25.0, "Adventure": 25.0, "Science Fiction": 25.0 }, "geometry": { "type": "Point", "coordinates": [19.4667, 42.7833] } }, { "type": "Feature", "properties": { "name": "South Africa", "movieCount": 38, "total": 38, "Drama": 31.58, "History": 10.53, "War": 7.89, "Action": 52.63, "Adventure": 28.95, "Science Fiction": 28.95, "Thriller": 39.47, "Mystery": 7.89, "Family": 2.63, "Comedy": 15.79, "Crime": 10.53, "Romance": 2.63, "Horror": 18.42, "Fantasy": 13.16, "Western": 2.63 }, "geometry": { "type": "Point", "coordinates": [22.937506, -30.559482] } }, { "type": "Feature", "properties": { "name": "Greece", "movieCount": 14, "total": 14, "Comedy": 28.57, "Romance": 42.86, "Crime": 7.14, "Drama": 78.57, "History": 7.14, "Adventure": 7.14, "Science Fiction": 14.29, "Horror": 7.14 }, "geometry": { "type": "Point", "coordinates": [21.824312, 39.074208] } }, { "type": "Feature", "properties": { "name": "Belarus", "movieCount": 1, "total": 1, "War": 100.0, "Drama": 100.0 }, "geometry": { "type": "Point", "coordinates": [27.953389, 53.709807] } }, { "type": "Feature", "properties": { "name": "Russia", "movieCount": 37, "total": 37, "War": 16.22, "Drama": 51.35, "Action": 51.35, "Crime": 5.41, "Fantasy": 21.62, "History": 13.51, "Romance": 8.11, "Adventure": 29.73, "Animation": 2.7, "Comedy": 5.41, "Science Fiction": 24.32, "Thriller": 32.43, "Horror": 16.22, "Mystery": 8.11, "Family": 2.7 }, "geometry": { "type": "Point", "coordinates": [105.318756, 61.52401] } }, { "type": "Feature", "properties": { "name": "Estonia", "movieCount": 2, "total": 2, "Drama": 100.0, "War": 50.0 }, "geometry": { "type": "Point", "coordinates": [25.013607, 58.595272] } }, { "type": "Feature", "properties": { "name": "Georgia", "movieCount": 1, "total": 1, "Drama": 100.0, "War": 100.0 }, "geometry": { "type": "Point", "coordinates": [43.356892, 42.315407] } }, { "type": "Feature", "properties": { "name": "Venezuela", "movieCount": 2, "total": 2, "Drama": 50.0, "Adventure": 50.0, "Horror": 50.0 }, "geometry": { "type": "Point", "coordinates": [-66.58973, 6.42375] } }, { "type": "Feature", "properties": { "name": "Ukraine", "movieCount": 6, "total": 6, "War": 33.33, "Action": 33.33, "Drama": 66.67, "Romance": 16.67, "Animation": 16.67, "Adventure": 16.67, "Family": 16.67, "Fantasy": 16.67, "Thriller": 50.0, "Comedy": 16.67, "History": 16.67 }, "geometry": { "type": "Point", "coordinates": [31.16558, 48.379433] } }, { "type": "Feature", "properties": { "name": "Bosnia and Herzegovina", "movieCount": 3, "total": 3, "War": 66.67, "Drama": 66.67, "History": 66.67, "Crime": 33.33, "Action": 33.33 }, "geometry": { "type": "Point", "coordinates": [17.679076, 43.915886] } }, { "type": "Feature", "properties": { "name": "Montenegro", "movieCount": 2, "total": 2, "War": 50.0, "Drama": 100.0, "History": 50.0, "Thriller": 50.0 }, "geometry": { "type": "Point", "coordinates": [19.37439, 42.708678] } }, { "type": "Feature", "properties": { "name": "Romania", "movieCount": 22, "total": 22, "War": 13.64, "Drama": 50.0, "History": 18.18, "Romance": 18.18, "Comedy": 13.64, "Science Fiction": 13.64, "Thriller": 45.45, "Mystery": 31.82, "Action": 9.09, "Music": 4.55, "Adventure": 4.55, "Western": 4.55, "Horror": 31.82, "Crime": 4.55, "Fantasy": 4.55 }, "geometry": { "type": "Point", "coordinates": [24.96676, 45.943161] } }, { "type": "Feature", "properties": { "name": "Indonesia", "movieCount": 8, "total": 8, "Action": 75.0, "Crime": 62.5, "Thriller": 75.0, "Horror": 12.5, "Drama": 12.5, "Fantasy": 12.5, "Science Fiction": 25.0, "Adventure": 12.5 }, "geometry": { "type": "Point", "coordinates": [113.921327, -0.789275] } }, { "type": "Feature", "properties": { "name": "Serbia", "movieCount": 7, "total": 7, "Drama": 42.86, "Action": 42.86, "War": 14.29, "Thriller": 71.43, "Horror": 42.86, "Crime": 28.57, "Mystery": 14.29 }, "geometry": { "type": "Point", "coordinates": [21.005859, 44.016521] } }, { "type": "Feature", "properties": { "name": "Peru", "movieCount": 7, "total": 7, "Drama": 57.14, "Adventure": 57.14, "History": 14.29, "Animation": 14.29, "Family": 14.29, "Fantasy": 14.29, "Action": 28.57, "Thriller": 42.86, "Horror": 14.29 }, "geometry": { "type": "Point", "coordinates": [-75.015152, -9.189967] } }, { "type": "Feature", "properties": { "name": "Ghana", "movieCount": 1, "total": 1, "Drama": 100.0, "War": 100.0 }, "geometry": { "type": "Point", "coordinates": [-1.023194, 7.946527] } }, { "type": "Feature", "properties": { "name": "Singapore", "movieCount": 6, "total": 6, "Thriller": 16.67, "History": 16.67, "Drama": 33.33, "Action": 50.0, "Adventure": 33.33, "Animation": 16.67, "Horror": 50.0, "Science Fiction": 16.67 }, "geometry": { "type": "Point", "coordinates": [103.819836, 1.352083] } }, { "type": "Feature", "properties": { "name": "Slovenia", "movieCount": 2, "total": 2, "Action": 50.0, "History": 50.0, "War": 50.0, "Adventure": 50.0, "Family": 50.0, "Fantasy": 50.0 }, "geometry": { "type": "Point", "coordinates": [14.995463, 46.151241] } }, { "type": "Feature", "properties": { "name": "Morocco", "movieCount": 14, "total": 14, "Comedy": 14.29, "Drama": 78.57, "War": 35.71, "Action": 42.86, "History": 35.71, "Adventure": 28.57, "Western": 7.14, "Thriller": 14.29, "Crime": 7.14, "Romance": 14.29, "Music": 7.14 }, "geometry": { "type": "Point", "coordinates": [-7.09262, 31.791702] } }, { "type": "Feature", "properties": { "name": "Chile", "movieCount": 9, "total": 9, "Drama": 66.67, "History": 22.22, "Horror": 33.33, "Thriller": 33.33, "Adventure": 11.11 }, "geometry": { "type": "Point", "coordinates": [-71.542969, -35.675147] } }, { "type": "Feature", "properties": { "name": "Cambodia", "movieCount": 1, "total": 1, "War": 100.0, "Drama": 100.0, "History": 100.0 }, "geometry": { "type": "Point", "coordinates": [104.990963, 12.565679] } }, { "type": "Feature", "properties": { "name": "Kenya", "movieCount": 1, "total": 1, "Drama": 100.0 }, "geometry": { "type": "Point", "coordinates": [37.906193, -0.023559] } }, { "type": "Feature", "properties": { "name": "Malta", "movieCount": 7, "total": 7, "Drama": 71.43, "War": 28.57, "Action": 42.86, "History": 42.86, "Adventure": 42.86, "Horror": 14.29, "Science Fiction": 14.29, "Thriller": 14.29, "Romance": 14.29, "Family": 14.29, "Comedy": 14.29 }, "geometry": { "type": "Point", "coordinates": [14.375416, 35.937496] } }, { "type": "Feature", "properties": { "name": "Croatia", "movieCount": 1, "total": 1, "Drama": 100.0, "Romance": 100.0, "War": 100.0 }, "geometry": { "type": "Point", "coordinates": [15.2, 45.1] } }, { "type": "Feature", "properties": { "name": "Kuwait", "movieCount": 1, "total": 1, "Adventure": 100.0, "Drama": 100.0, "Action": 100.0, "History": 100.0 }, "geometry": { "type": "Point", "coordinates": [47.481766, 29.31166] } }, { "type": "Feature", "properties": { "name": "Libyan Arab Jamahiriya", "movieCount": 1, "total": 1, "Adventure": 100.0, "Drama": 100.0, "Action": 100.0, "History": 100.0 }, "geometry": { "type": "Point", "coordinates": [17.2283, 26.3351] } }, { "type": "Feature", "properties": { "name": "Saudi Arabia", "movieCount": 2, "total": 2, "Adventure": 50.0, "Drama": 100.0, "Action": 50.0, "History": 50.0 }, "geometry": { "type": "Point", "coordinates": [45.079162, 23.885942] } }, { "type": "Feature", "properties": { "name": "Jordan", "movieCount": 3, "total": 3, "Drama": 100.0, "Horror": 33.33, "War": 33.33 }, "geometry": { "type": "Point", "coordinates": [36.238414, 30.585164] } }, { "type": "Feature", "properties": { "name": "Botswana", "movieCount": 2, "total": 2, "Action": 100.0, "Comedy": 100.0 }, "geometry": { "type": "Point", "coordinates": [24.684866, -22.328474] } }, { "type": "Feature", "properties": { "name": "Lithuania", "movieCount": 6, "total": 6, "War": 16.67, "History": 16.67, "Drama": 50.0, "Crime": 50.0, "Science Fiction": 33.33, "Adventure": 16.67, "Thriller": 33.33, "Mystery": 16.67, "Action": 33.33, "Comedy": 16.67 }, "geometry": { "type": "Point", "coordinates": [23.881275, 55.169438] } }, { "type": "Feature", "properties": { "name": "Panama", "movieCount": 3, "total": 3, "Science Fiction": 33.33, "Action": 33.33, "Adventure": 33.33, "War": 33.33, "History": 33.33, "Drama": 66.67 }, "geometry": { "type": "Point", "coordinates": [-80.782127, 8.537981] } }, { "type": "Feature", "properties": { "name": "Bolivia", "movieCount": 1, "total": 1, "Comedy": 100.0 }, "geometry": { "type": "Point", "coordinates": [-63.588653, -16.290154] } }, { "type": "Feature", "properties": { "name": "Vietnam", "movieCount": 1, "total": 1, "Drama": 100.0, "Romance": 100.0 }, "geometry": { "type": "Point", "coordinates": [108.277199, 14.058324] } }, { "type": "Feature", "properties": { "name": "Macao", "movieCount": 1, "total": 1, "Drama": 100.0, "History": 100.0, "Action": 100.0 }, "geometry": { "type": "Point", "coordinates": [113.5439, 22.1987] } }, { "type": "Feature", "properties": { "name": "Portugal", "movieCount": 6, "total": 6, "Romance": 33.33, "Drama": 33.33, "Adventure": 33.33, "Comedy": 16.67, "Mystery": 33.33, "Thriller": 33.33, "Horror": 33.33, "Science Fiction": 16.67, "Fantasy": 16.67, "Action": 16.67 }, "geometry": { "type": "Point", "coordinates": [-8.224454, 39.399872] } }, { "type": "Feature", "properties": { "name": "Cuba", "movieCount": 1, "total": 1, "Comedy": 100.0, "Thriller": 100.0, "Music": 100.0 }, "geometry": { "type": "Point", "coordinates": [-77.781167, 21.521757] } }, { "type": "Feature", "properties": { "name": "Kazakhstan", "movieCount": 1, "total": 1, "History": 100.0, "Adventure": 100.0, "War": 100.0, "Action": 100.0 }, "geometry": { "type": "Point", "coordinates": [66.923684, 48.019573] } }, { "type": "Feature", "properties": { "name": "Guadaloupe", "movieCount": 1, "total": 1, "Thriller": 100.0, "Action": 100.0 }, "geometry": { "type": "Point", "coordinates": [-61.551, 16.265] } }, { "type": "Feature", "properties": { "name": "Myanmar", "movieCount": 1, "total": 1, "Drama": 100.0, "Romance": 100.0, "Comedy": 100.0 }, "geometry": { "type": "Point", "coordinates": [95.956, 21.9162] } }, { "type": "Feature", "properties": { "name": "Uruguay", "movieCount": 1, "total": 1, "Drama": 100.0, "Adventure": 100.0 }, "geometry": { "type": "Point", "coordinates": [-55.765835, -32.522779] } }, { "type": "Feature", "properties": { "name": "Israel", "movieCount": 6, "total": 6, "Comedy": 16.67, "Crime": 16.67, "Thriller": 66.67, "Horror": 50.0, "War": 16.67, "Drama": 16.67, "Science Fiction": 33.33, "Animation": 16.67, "Action": 33.33, "Adventure": 16.67 }, "geometry": { "type": "Point", "coordinates": [34.851612, 31.046051] } }, { "type": "Feature", "properties": { "name": "Albania", "movieCount": 1, "total": 1, "Drama": 100.0 }, "geometry": { "type": "Point", "coordinates": [20.168331, 41.153332] } }, { "type": "Feature", "properties": { "name": "Slovakia", "movieCount": 2, "total": 2, "Fantasy": 50.0, "Action": 50.0, "Adventure": 50.0, "Drama": 50.0, "Music": 50.0, "Comedy": 50.0 }, "geometry": { "type": "Point", "coordinates": [19.699024, 48.669026] } }, { "type": "Feature", "properties": { "name": "Iraq", "movieCount": 1, "total": 1, "War": 100.0, "Action": 100.0, "Drama": 100.0 }, "geometry": { "type": "Point", "coordinates": [43.679291, 33.223191] } }, { "type": "Feature", "properties": { "name": "Guatemala", "movieCount": 1, "total": 1, "Thriller": 100.0, "Horror": 100.0, "Drama": 100.0 }, "geometry": { "type": "Point", "coordinates": [-90.230759, 15.783471] } }, { "type": "Feature", "properties": { "name": "Liechtenstein", "movieCount": 1, "total": 1, "Drama": 100.0, "History": 100.0 }, "geometry": { "type": "Point", "coordinates": [9.555373, 47.166] } }, { "type": "Feature", "properties": { "name": "Malaysia", "movieCount": 1, "total": 1, "Horror": 100.0, "Science Fiction": 100.0, "Mystery": 100.0, "Thriller": 100.0 }, "geometry": { "type": "Point", "coordinates": [101.975766, 4.210484] } }, { "type": "Feature", "properties": { "name": "Bahamas", "movieCount": 2, "total": 2, "Comedy": 50.0, "Science Fiction": 50.0, "Adventure": 50.0, "Crime": 50.0, "Drama": 50.0, "Thriller": 50.0 }, "geometry": { "type": "Point", "coordinates": [-77.39628, 25.03428] } }, { "type": "Feature", "properties": { "name": "Aruba", "movieCount": 1, "total": 1, "Action": 100.0, "Crime": 100.0, "Thriller": 100.0 }, "geometry": { "type": "Point", "coordinates": [-69.968338, 12.52111] } }] }


const countryNames = geojson.features.map(feature => feature.properties.name);
const select = document.getElementById('country-select1');
const select2 = document.getElementById('country-select2');
countryNames.forEach(name => {
  const option = document.createElement('option');
  const option2 = document.createElement('option');
  option.value = name;
  option2.value = name;
  option.textContent = name;
  option2.textContent = name;
  if (name != "United States of America") {
    select.appendChild(option);
  }
  if (name != "Japan") {
    select2.appendChild(option2)
  }
});

function createD3HistoVisualization(countryName) {
  // Clear any existing visualization
  const container = d3.select('#histogram-container');
  container.html('');

  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }


    const filteredData = filterDataByCountry(data, countryName);

    console.log(filteredData)

    // Extract vote averages and remove invalid data
    const voteAverages = filteredData.map(d => +d.vote_average).filter(v => !isNaN(v));

    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    // Select the container and append the SVG to it
    const container = d3.select('#histogram-container');
    container.html(''); // Clear any previous content

    var svg = d3.select('#histogram-container').append('svg')
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // // X axis: scale and draw
    const x = d3.scaleLinear()
      .domain([0, 10]) // Make sure this includes the range of your data
      .range([0, width]);
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x));

    // Add X axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left)
      .attr("y", height + margin.top + 20)
      .text("User Rating Avg.");


    // Set the parameters for the histogram
    const histogram = d3.histogram()
      .value(d => d)
      .domain(x.domain())
      .thresholds(x.ticks(20)); // number of bins
    const bins = histogram(voteAverages);

    // Y axis: scale and draw
    const y = d3.scaleLinear()
      .range([height, 0])
      .domain([0, d3.max(bins, d => d.length)]);
    svg.append("g")
      .call(d3.axisLeft(y));

    // Add Y axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Number of Movies");

    // Add title to the histogram
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text(`User Rating Avg. Distribution for ${countryName}`);

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Append the bar rectangles to the svg element
    svg.selectAll("rect")
      .data(bins)
      .join("rect")
      .attr("x", d => x(d.x0) + 1)
      .attr("transform", d => `translate(0,${y(d.length)})`)
      // .attr("width", d => x(d.x1) - x(d.x0) - 1)
      .attr("width", d => Math.max(0, x(d.x1) - x(d.x0) - 1))
      .attr("height", d => height - y(d.length))
      .style("fill", "#69b3a2")
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Range: ${d.x0} to ${d.x1}<br>Count: ${d.length}`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });
  });
}

function createD3GenreVisualization(countryName) {
  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country and calculate total budget and revenue
    function filterDataByCountry(data, country) {
      let genreCounts = {}; // Object to hold counts of each genre
      const filteredData = data.filter(d => {
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          const countries = JSON.parse(jsonString);
          const isProducedInCountry = countries.some(countryObj => countryObj.name === country);

          if (isProducedInCountry) {
            // Parse the genres field, which is expected to be in JSON format
            const genres = JSON.parse(d.genres.replace(/'/g, "\""));
            // Loop through each genre in the genres list
            genres.forEach(genre => {
              // If the genre name isn't in the genreCounts object, add it with a count of 1
              if (!genreCounts[genre.name]) {
                genreCounts[genre.name] = 1;
              } else {
                // If it is, increment the count
                genreCounts[genre.name]++;
              }
            });
          }

          return isProducedInCountry;
        } catch (e) {
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });

      return {
        data: filteredData,
        genres: genreCounts, // Return the object with genre counts instead of a list
      };
    }

    const result = filterDataByCountry(data, countryName);

    console.log("Filtered Data:", result.genres);

    // Create the pie chart visualization
    const genres = result.genres;

    // Sort genres by counts and take top two
    const topGenres = Object.entries(genres).sort((a, b) => b[1] - a[1]).slice(0, 2);

    const width = 460, height = 400, margin = 40;
    const radius = Math.min(width, height) / 2 - margin;

    // Create a color scale
    const color = d3.scaleOrdinal()
      .domain(Object.keys(genres))
      .range(d3.schemeTableau10); // This is an example of a D3 color scheme with more colors

    // Append the svg object to the div with id 'genrePieChart'                    
    // const container = d3.select('#genre-container');

    var svg = d3.select('#genre-container').append('svg')
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", `translate(${170},${190})`);

    // Compute the position of each group on the pie chart
    const pie = d3.pie()
      .value(d => d[1]); // d[1] is the value since Object.entries produces an array of [key, value] pairs
    const data_ready = pie(Object.entries(genres));

    console.log("dataready", data_ready)

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Add a group for each slice of the pie
    const arcs = svg.selectAll('arc')
      .data(data_ready)
      .enter()
      .append('g')
      .attr('class', 'arc');

    // Append the path of the arc (slice)
    arcs.append('path')
      .attr('d', d3.arc()
        .innerRadius(0)
        .outerRadius(radius)
      )
      .attr('fill', d => color(d.data[0]))
      .attr("stroke", "white")
      .style("stroke-width", "2px")
      .style("opacity", 0.7)
      // Mouseover event to display tooltip
      .on('mouseover', function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(d.data[0] + ": " + d.data[1])
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      // Mouseout event to hide tooltip
      .on('mouseout', function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

    arcs.append("text")
      .attr("transform", function(d) {
        const centroid = d3.arc().innerRadius(0).outerRadius(radius).centroid(d);
        // return "translate(" + centroid + ")";
        return "translate(" + (centroid[0] + 10) + "," + centroid[1] + ")";
      })
      .attr("text-anchor", "middle")
      .style("font-size", "12px")
      .style("font-weight", "bold") // Make the text bold
      .text(function(d) {
        // Check if this slice is one of the top genres
        for (let i = 0; i < topGenres.length; i++) {
          if (d.data[0] === topGenres[i][0]) {
            return `${d.data[0]}: ${d.data[1]}`;
          }
        }
        return ""; // Don't show label for non-top genres
      });

    svg.append("text")
      .attr("x", 0)
      .attr("y", -175)
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .attr('fill', 'black')
      .text(`Genre Distribution for ${countryName}`);

  });
}

function createD3TimeViz(countryName) {
  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }

    const filteredData = filterDataByCountry(data, countryName);
    console.log("filtered dfata", filteredData)

    const movieDates = filteredData.map(d => d.release_date);

    console.log("movive dates:", movieDates)


    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    const parseDate = d3.timeParse("%Y-%m-%d");
    const dates = movieDates.map(d => parseDate(d));

    // Group data by decade
    const moviesByDecade = d3.group(dates, d => Math.floor(d.getFullYear() / 10) * 10);

    // Nested grouping by year within each decade
    moviesByDecade.forEach((value, key) => {
      moviesByDecade.set(key, d3.group(value, d => d.getFullYear()));
    });

    const sortedDecades = Array.from(moviesByDecade.keys()).sort((a, b) => a - b);


    // Set up the SVG container
    const container = d3.select('#date-container');
    container.html(''); // Clear previous content

    var svg = d3.select('#date-container').append('svg')
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // X axis: scale and draw
    const x = d3.scaleBand()
      // .domain(Array.from(moviesByDecade.keys()))
      .domain(sortedDecades)
      .range([0, width])
      .padding(0.1);
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x).tickFormat(d => d + 's'));

    // Compute the maximum count for the y axis
    let maxCount = 0;
    moviesByDecade.forEach(decade => {
      let count = 0;
      decade.forEach(year => count += year.length);
      maxCount = Math.max(maxCount, count);
    });

    // Y axis: scale and draw
    const y = d3.scaleLinear()
      .domain([0, maxCount])
      .range([height, 0]);
    svg.append("g")
      .call(d3.axisLeft(y));

    // Create the bars
    svg.selectAll(".decade")
      .data(Array.from(moviesByDecade.entries()))
      .join("g")
      .attr("class", "decade")
      .attr("transform", d => `translate(${x(d[0])},0)`)
      .selectAll("rect")
      .data(d => {
        const years = Array.from(d[1].entries());
        let cumCount = 0;
        return years.map(year => {
          const count = year[1].length;
          const rect = { year: year[0], y0: cumCount, y1: cumCount + count };
          cumCount += count;
          return rect;
        });
      })
      .join("rect")
      .attr("x", 0)
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.y1))
      .attr("height", d => y(d.y0) - y(d.y1))
      .style("fill", d => d3.schemeTableau10[d.year % 10]); // Assign colors based on year

    // Add labels, tooltips, etc., as needed

    // Add X axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left - 25)
      .attr("y", height + margin.top + 20)
      .text("Date");

    // Add Y axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Number of Movies");

    // Add title to the histogram
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text(`Date Distribution`);

    // Tooltip setup
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("text-align", "center")
      .style("width", "120px")
      .style("height", "28px")
      .style("padding", "2px")
      .style("font", "12px sans-serif")
      .style("background", "lightsteelblue")
      .style("border", "0px")
      .style("border-radius", "8px")
      .style("pointer-events", "none");

    // Create the bars and attach updated tooltip events
    svg.selectAll(".decade")
      .data(Array.from(moviesByDecade.entries()))
      .join("g")
      .attr("class", "decade")
      .attr("transform", d => `translate(${x(d[0])},0)`)
      .selectAll("rect")
      .data(d => {
        const years = Array.from(d[1].entries());
        let cumCount = 0;
        return years.map(year => {
          const count = year[1].length;
          const rect = { year: year[0], y0: cumCount, y1: cumCount + count };
          cumCount += count;
          return rect;
        });
      })
      .join("rect")
      .attr("x", 0)
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.y1))
      .attr("height", d => y(d.y0) - y(d.y1))
      .style("fill", d => d3.schemeTableau10[d.year % 10]) // Assign colors based on year
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Year: ${d.year}<br>Count: ${d.y1 - d.y0}`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

  });
}

function createD3BudgetViz(countryName) {
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }

    const filteredData = filterDataByCountry(data, countryName);
    console.log("filtered dfata", filteredData)

    const budgetData = filteredData.map(d => d.budget);
    const revenueData = filteredData.map(d => d.revenue);

    const titles = filteredData.map(d => d.title);

    console.log("budget data:", budgetData)
    console.log("revenue data:", revenueData)

    // Convert strings to numbers and pair up budget and revenue, filtering out zeros
    const moneyData = budgetData.map((budget, index) => ({
      budget: +budget,
      revenue: +revenueData[index],
      title: titles[index]
    })).filter(item => item.budget !== 0 && item.revenue !== 0);

    // Find the movies with the top two revenues and top budget
    const topRevenueMovies = moneyData.sort((a, b) => b.revenue - a.revenue).slice(0, 2);
    // const topBudgetMovie = moneyData.sort((a, b) => b.budget - a.budget)[0];


    // Now 'data' is an array of objects, each with 'budget' and 'revenue' properties

    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    // const container = d3.select('#budget-container');

    // Set up SVG container
    const svg = d3.select("#budget-container").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // Adjust the data scale (divide by 1 million)
    moneyData.forEach(d => {
      d.budget /= 1000000; // Convert to millions
      d.revenue /= 1000000; // Convert to millions
    });

    // Update the scales
    const x = d3.scaleLinear()
      .domain([0, d3.max(moneyData, d => d.budget)])
      .range([0, width]);
    const y = d3.scaleLinear()
      .domain([0, d3.max(moneyData, d => d.revenue)])
      .range([height, 0]);

    // Draw axes and add labels
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x))
      .append("text")
      .attr("y", 30) // Adjust the position
      .attr("x", width / 2)
      .attr("text-anchor", "end")

    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left)
      .attr("y", height + margin.top + 20)
      .text("Budget (in millions)");

    svg.append("g")
      .call(d3.axisLeft(y))
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", -40) // Adjust the position
      .attr("x", -height / 2)
      .attr("text-anchor", "end")

    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Revenue (in millions)");

    // Add scatter plot title
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text("Movie Budget vs. Revenue");

    // Add labels for the top two revenue movies
    topRevenueMovies.forEach(movie => {
      svg.append("text")
        .attr("x", x(movie.budget))
        .attr("y", y(movie.revenue) + 20) // Position below the dot
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("font-weight", "bold") // Bold text
        .text(movie.title);
    });

    // // Add label for the top budget movie
    // svg.append("text")
    //   .attr("x", x(topBudgetMovie.budget))
    //   .attr("y", y(topBudgetMovie.revenue) + 20) // Position below the dot
    //   .attr("text-anchor", "middle")
    //   .style("font-size", "12px")
    //   .style("font-weight", "bold") // Bold text
    //   .text(topBudgetMovie.title);

    // Add tooltips
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("text-align", "center")
      .style("width", "160px")
      .style("height", "56px")
      .style("padding", "2px")
      .style("font", "12px sans-serif")
      .style("background", "lightsteelblue")
      .style("border", "0px")
      .style("border-radius", "8px")
      .style("pointer-events", "none");

    // Plot data points and add tooltip events
    svg.selectAll(".dot")
      .data(moneyData)
      .enter().append("circle")
      .attr("class", "dot")
      .attr("cx", d => x(d.budget))
      .attr("cy", d => y(d.revenue))
      .attr("r", 5)
      .style("fill", "#FA8072") //#FA8072
      // .style("stroke", "#FA8072")
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Movie: ${d.title}<br>Budget: $${d.budget}M<br>Revenue: $${d.revenue}M`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

  });
}

function createD3HistoVisualization2(countryName) {
  // Clear any existing visualization
  const container = d3.select('#histogram-container2');
  container.html('');

  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }


    const filteredData = filterDataByCountry(data, countryName);

    console.log(filteredData)

    // Extract vote averages and remove invalid data
    const voteAverages = filteredData.map(d => +d.vote_average).filter(v => !isNaN(v));

    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    // Select the container and append the SVG to it
    const container = d3.select('#histogram-container2');
    container.html(''); // Clear any previous content

    var svg = d3.select('#histogram-container2').append('svg')
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // // X axis: scale and draw
    const x = d3.scaleLinear()
      .domain([0, 10]) // Make sure this includes the range of your data
      .range([0, width]);
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x));

    // Add X axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left)
      .attr("y", height + margin.top + 20)
      .text("User Rating Avg.");


    // Set the parameters for the histogram
    const histogram = d3.histogram()
      .value(d => d)
      .domain(x.domain())
      .thresholds(x.ticks(20)); // number of bins
    const bins = histogram(voteAverages);

    // Y axis: scale and draw
    const y = d3.scaleLinear()
      .range([height, 0])
      .domain([0, d3.max(bins, d => d.length)]);
    svg.append("g")
      .call(d3.axisLeft(y));

    // Add Y axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Number of Movies");

    // Add title to the histogram
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text(`User Rating Avg. Distribution for ${countryName}`);

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Append the bar rectangles to the svg element
    svg.selectAll("rect")
      .data(bins)
      .join("rect")
      .attr("x", d => x(d.x0) + 1)
      .attr("transform", d => `translate(0,${y(d.length)})`)
      // .attr("width", d => x(d.x1) - x(d.x0) - 1)
      .attr("width", d => Math.max(0, x(d.x1) - x(d.x0) - 1))
      .attr("height", d => height - y(d.length))
      .style("fill", "#69b3a2")
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Range: ${d.x0} to ${d.x1}<br>Count: ${d.length}`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });
  });
}

function createD3GenreVisualization2(countryName) {
  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country and calculate total budget and revenue
    function filterDataByCountry(data, country) {
      let genreCounts = {}; // Object to hold counts of each genre
      const filteredData = data.filter(d => {
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          const countries = JSON.parse(jsonString);
          const isProducedInCountry = countries.some(countryObj => countryObj.name === country);

          if (isProducedInCountry) {
            // Parse the genres field, which is expected to be in JSON format
            const genres = JSON.parse(d.genres.replace(/'/g, "\""));
            // Loop through each genre in the genres list
            genres.forEach(genre => {
              // If the genre name isn't in the genreCounts object, add it with a count of 1
              if (!genreCounts[genre.name]) {
                genreCounts[genre.name] = 1;
              } else {
                // If it is, increment the count
                genreCounts[genre.name]++;
              }
            });
          }

          return isProducedInCountry;
        } catch (e) {
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });

      return {
        data: filteredData,
        genres: genreCounts, // Return the object with genre counts instead of a list
      };
    }

    const result = filterDataByCountry(data, countryName);

    console.log("Filtered Data:", result.genres);

    // Create the pie chart visualization
    const genres = result.genres;
    // Sort genres by counts and take top two
    const topGenres = Object.entries(genres).sort((a, b) => b[1] - a[1]).slice(0, 2);

    const width = 460, height = 400, margin = 40;
    const radius = Math.min(width, height) / 2 - margin;

    // Create a color scale
    const color = d3.scaleOrdinal()
      .domain(Object.keys(genres))
      .range(d3.schemeTableau10); // This is an example of a D3 color scheme with more colors

    // Append the svg object to the div with id 'genrePieChart'                    
    // const container = d3.select('#genre-container2');

    var svg = d3.select('#genre-container2').append('svg')
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", `translate(${170},${190})`);

    // Compute the position of each group on the pie chart
    const pie = d3.pie()
      .value(d => d[1]); // d[1] is the value since Object.entries produces an array of [key, value] pairs
    const data_ready = pie(Object.entries(genres));

    console.log("dataready", data_ready)

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Add a group for each slice of the pie
    const arcs = svg.selectAll('arc')
      .data(data_ready)
      .enter()
      .append('g')
      .attr('class', 'arc');

    // Append the path of the arc (slice)
    arcs.append('path')
      .attr('d', d3.arc()
        .innerRadius(0)
        .outerRadius(radius)
      )
      .attr('fill', d => color(d.data[0]))
      .attr("stroke", "white")
      .style("stroke-width", "2px")
      .style("opacity", 0.7)
      // Mouseover event to display tooltip
      .on('mouseover', function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(d.data[0] + ": " + d.data[1])
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      // Mouseout event to hide tooltip
      .on('mouseout', function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

    arcs.append("text")
      .attr("transform", function(d) {
        const centroid = d3.arc().innerRadius(0).outerRadius(radius).centroid(d);
        // return "translate(" + centroid + ")";
        return "translate(" + (centroid[0] + 10) + "," + centroid[1] + ")";
      })
      .attr("text-anchor", "middle")
      .style("font-size", "12px")
      .style("font-weight", "bold") // Make the text bold
      .text(function(d) {
        // Check if this slice is one of the top genres
        for (let i = 0; i < topGenres.length; i++) {
          if (d.data[0] === topGenres[i][0]) {
            return `${d.data[0]}: ${d.data[1]}`;
          }
        }
        return ""; // Don't show label for non-top genres
      });

    svg.append("text")
      .attr("x", 0)
      .attr("y", -175)
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .attr('fill', 'black')
      .text(`Genre Distribution for ${countryName}`);

  });
}

function createD3TimeViz2(countryName) {
  // Load the CSV file
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }

    const filteredData = filterDataByCountry(data, countryName);
    console.log("filtered dfata", filteredData)

    const movieDates = filteredData.map(d => d.release_date);

    console.log("movive dates:", movieDates)


    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    const parseDate = d3.timeParse("%Y-%m-%d");
    const dates = movieDates.map(d => parseDate(d));

    // Group data by decade
    const moviesByDecade = d3.group(dates, d => Math.floor(d.getFullYear() / 10) * 10);

    // Nested grouping by year within each decade
    moviesByDecade.forEach((value, key) => {
      moviesByDecade.set(key, d3.group(value, d => d.getFullYear()));
    });

    const sortedDecades = Array.from(moviesByDecade.keys()).sort((a, b) => a - b);


    // Set up the SVG container
    const container = d3.select('#date-container2');
    container.html(''); // Clear previous content

    var svg = d3.select('#date-container2').append('svg')
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // X axis: scale and draw
    const x = d3.scaleBand()
      // .domain(Array.from(moviesByDecade.keys()))
      .domain(sortedDecades)
      .range([0, width])
      .padding(0.1);
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x).tickFormat(d => d + 's'));

    // Compute the maximum count for the y axis
    let maxCount = 0;
    moviesByDecade.forEach(decade => {
      let count = 0;
      decade.forEach(year => count += year.length);
      maxCount = Math.max(maxCount, count);
    });

    // Y axis: scale and draw
    const y = d3.scaleLinear()
      .domain([0, maxCount])
      .range([height, 0]);
    svg.append("g")
      .call(d3.axisLeft(y));

    // Create the bars
    svg.selectAll(".decade")
      .data(Array.from(moviesByDecade.entries()))
      .join("g")
      .attr("class", "decade")
      .attr("transform", d => `translate(${x(d[0])},0)`)
      .selectAll("rect")
      .data(d => {
        const years = Array.from(d[1].entries());
        let cumCount = 0;
        return years.map(year => {
          const count = year[1].length;
          const rect = { year: year[0], y0: cumCount, y1: cumCount + count };
          cumCount += count;
          return rect;
        });
      })
      .join("rect")
      .attr("x", 0)
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.y1))
      .attr("height", d => y(d.y0) - y(d.y1))
      .style("fill", d => d3.schemeTableau10[d.year % 10]); // Assign colors based on year

    // Add labels, tooltips, etc., as needed

    // Add X axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left - 25)
      .attr("y", height + margin.top + 20)
      .text("Date");

    // Add Y axis label
    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Number of Movies");

    // Add title to the histogram
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text(`Date Distribution`);

    // Tooltip setup
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("text-align", "center")
      .style("width", "120px")
      .style("height", "28px")
      .style("padding", "2px")
      .style("font", "12px sans-serif")
      .style("background", "lightsteelblue")
      .style("border", "0px")
      .style("border-radius", "8px")
      .style("pointer-events", "none");

    // Create the bars and attach updated tooltip events
    svg.selectAll(".decade")
      .data(Array.from(moviesByDecade.entries()))
      .join("g")
      .attr("class", "decade")
      .attr("transform", d => `translate(${x(d[0])},0)`)
      .selectAll("rect")
      .data(d => {
        const years = Array.from(d[1].entries());
        let cumCount = 0;
        return years.map(year => {
          const count = year[1].length;
          const rect = { year: year[0], y0: cumCount, y1: cumCount + count };
          cumCount += count;
          return rect;
        });
      })
      .join("rect")
      .attr("x", 0)
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.y1))
      .attr("height", d => y(d.y0) - y(d.y1))
      .style("fill", d => d3.schemeTableau10[d.year % 10]) // Assign colors based on year
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Year: ${d.year}<br>Count: ${d.y1 - d.y0}`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

  });
}

function createD3BudgetViz2(countryName) {
  d3.csv("movie_details.csv").then(data => {
    // Filter data by the selected country
    function filterDataByCountry(data, country) {
      return data.filter(d => {
        // Ensure the string is in a valid JSON format
        const jsonString = d.production_countries.replace(/'/g, "\"");
        try {
          // Attempt to parse the production_countries field
          const countries = JSON.parse(jsonString);
          return countries.some(countryObj => countryObj.name === country);
        } catch (e) {
          // If parsing fails, log the error and exclude this row from the results
          console.error("Parsing error in row:", d, e);
          return false;
        }
      });
    }

    const filteredData = filterDataByCountry(data, countryName);
    console.log("filtered dfata", filteredData)

    const budgetData = filteredData.map(d => d.budget);
    const revenueData = filteredData.map(d => d.revenue);
    const titles = filteredData.map(d => d.title);

    console.log("budget data:", budgetData)
    console.log("revenue data:", revenueData)

    // Convert strings to numbers and pair up budget and revenue, filtering out zeros
    const moneyData = budgetData.map((budget, index) => ({
      budget: +budget,
      revenue: +revenueData[index],
      title: titles[index]
    })).filter(item => item.budget !== 0 && item.revenue !== 0);

    // Find the movies with the top two revenues and top budget
    const topRevenueMovies = moneyData.sort((a, b) => b.revenue - a.revenue).slice(0, 2);
    // Now 'data' is an array of objects, each with 'budget' and 'revenue' properties

    // Create the histogram using voteAverages
    const margin = { top: 30, right: 30, bottom: 60, left: 60 },
      width = 460 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    const container = d3.select('#budget-container2');

    // Set up SVG container
    const svg = d3.select("#budget-container2").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // Adjust the data scale (divide by 1 million)
    moneyData.forEach(d => {
      d.budget /= 1000000; // Convert to millions
      d.revenue /= 1000000; // Convert to millions
    });

    // Update the scales
    const x = d3.scaleLinear()
      .domain([0, d3.max(moneyData, d => d.budget)])
      .range([0, width]);
    const y = d3.scaleLinear()
      .domain([0, d3.max(moneyData, d => d.revenue)])
      .range([height, 0]);

    // Draw axes and add labels
    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x))
      .append("text")
      .attr("y", 30) // Adjust the position
      .attr("x", width / 2)
      .attr("text-anchor", "end")

    svg.append("text")
      .attr("text-anchor", "end")
      .attr("x", width / 2 + margin.left)
      .attr("y", height + margin.top + 20)
      .text("Budget (in millions)");

    svg.append("g")
      .call(d3.axisLeft(y))
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", -40) // Adjust the position
      .attr("x", -height / 2)
      .attr("text-anchor", "end")

    svg.append("text")
      .attr("text-anchor", "end")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 20)
      .attr("x", -margin.top - height / 2 + 100)
      .text("Revenue (in millions)");

    // Add scatter plot title
    svg.append("text")
      .attr("x", width / 2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .style("text-decoration", "underline")
      .text("Movie Budget vs. Revenue");

    // Add labels for the top two revenue movies
    topRevenueMovies.forEach(movie => {
      svg.append("text")
        .attr("x", x(movie.budget))
        .attr("y", y(movie.revenue) + 20) // Position below the dot
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("font-weight", "bold") // Bold text
        .text(movie.title);
    });

    // Add tooltips
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0)
      .style("position", "absolute")
      .style("text-align", "center")
      .style("width", "160px")
      .style("height", "56px")
      .style("padding", "2px")
      .style("font", "12px sans-serif")
      .style("background", "lightsteelblue")
      .style("border", "0px")
      .style("border-radius", "8px")
      .style("pointer-events", "none");

    // Plot data points and add tooltip events
    svg.selectAll(".dot")
      .data(moneyData)
      .enter().append("circle")
      .attr("class", "dot")
      .attr("cx", d => x(d.budget))
      .attr("cy", d => y(d.revenue))
      .attr("r", 5)
      .style("fill", "#FA8072")
      .on("mouseover", function(event, d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`Movie: ${d.title}<br>Budget: $${d.budget}M<br>Revenue: $${d.revenue}M`)
          .style("left", (event.pageX) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

  });
}

select.addEventListener('change', function() {
  const selectedCountry = this.value;
  const containerIds1 = ['histogram-container', 'budget-container', 'genre-container', 'date-container'];
  containerIds1.forEach(id => {
    const container = document.getElementById(id);
    if (container) {
      container.innerHTML = '';
    }
  });
  // Call the visualization update functions here, using the selected country
  // createD3HistoVisualization(selectedCountry);
  createD3GenreVisualization(selectedCountry);
  createD3BudgetViz(selectedCountry);
  createD3TimeViz(selectedCountry);
});

select2.addEventListener('change', function() {
  const selectedCountry = this.value;

  const containerIds1 = ['histogram-container2', 'budget-container2', 'genre-container2', 'date-container2'];
  containerIds1.forEach(id => {
    const container = document.getElementById(id);
    if (container) {
      container.innerHTML = '';
    }
  });
  // Call the visualization update functions here, using the selected country
  // createD3HistoVisualization2(selectedCountry);
  createD3BudgetViz2(selectedCountry);
  createD3GenreVisualization2(selectedCountry);
  createD3TimeViz2(selectedCountry);
});

document.addEventListener('DOMContentLoaded', (event) => {
  // createD3HistoVisualization('United States of America');
  createD3BudgetViz('United States of America');
  createD3GenreVisualization('United States of America');
  createD3TimeViz('United States of America');

  // createD3HistoVisualization2('Japan');
  createD3BudgetViz2('Japan');
  createD3GenreVisualization2('Japan');
  createD3TimeViz2('Japan');
});
var filteredData = null;
var curCountry = null;
var top5 = null;
var prevIndex = 0;
var l = 0;
var r = 5;
var eventListenersAdded = false;
var genreCounts = {};
var productionCompanyCounts = {};


const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/spectorr/clpsuzicg00fe01op2ne2812p',
  // style: 'mapbox://styles/spectorr/clpkcmygv008x01ol1votfrko',
  center: [130, 35],
  zoom: 1.85
});

// Add zoom and rotation controls to the map.
// map.addControl(new mapboxgl.NavigationControl())
// disable map zoom when using scroll
map.scrollZoom.disable();



map.on('load', () => {
  map.addSource('countries', {
    'type': 'geojson',
    'data': geojson
  });

  map.addLayer({
    'id': 'countries',
    'type': 'circle',
    'source': 'countries',
    'paint': {
      'circle-radius': {
        'property': 'movieCount',
        'type': 'exponential',
        'stops': [
          [{ zoom: 15, value: 1 }, 5],
          [{ zoom: 15, value: 30 }, 6],
          [{ zoom: 15, value: 100 }, 8],
          [{ zoom: 15, value: 1000 }, 10],
          [{ zoom: 15, value: 5000 }, 20]
        ]
      },
      'circle-color': {
        'property': 'movieCount',
        'type': 'exponential',
        'stops': [
          [1, '#FEF001'],
          [20, '#FFCE03'],
          [50, '#FD9A01'],
          [1000, '#FD6104'],
          [5000, '#F00505']
        ]
      }
    }
  });

  // Create a popup for hover, but don't add it to the map yet
  const hoverPopup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
  });

  map.on('mouseenter', 'countries', (e) => {
    map.getCanvas().style.cursor = 'pointer';

    const coordinates = e.features[0].geometry.coordinates.slice();
    // const movieCount = e.features[0].properties.movieCount;
    const description = e.features[0].properties.name + ': ' + e.features[0].properties.movieCount + ' movies';

    // Set the hover popup content and location
    hoverPopup
      .setLngLat(coordinates)
      .setHTML(description)
      .addTo(map);
  });

  map.on('mouseleave', 'countries', () => {
    map.getCanvas().style.cursor = '';
    hoverPopup.remove();
  });

  function handleImageClick(imgIndex) {
    refresh(imgIndex, null);
  }

  function handleArrowClick(nextClicked) {
    top5 = null;
    console.log('handleArrowClick');
    if (nextClicked) {
      refresh(0, true);
    }
    else {
      refresh(0, false);
    }
  }

  function addEventListeners() {
    //add event listeners
    document.getElementById("dynamicImage0").addEventListener("click", function() {
      handleImageClick(0);
    });
    document.getElementById("dynamicImage1").addEventListener("click", function() {
      handleImageClick(1);
    });
    document.getElementById("dynamicImage2").addEventListener("click", function() {
      handleImageClick(2);
    });
    document.getElementById("dynamicImage3").addEventListener("click", function() {
      handleImageClick(3);
    });
    document.getElementById("dynamicImage4").addEventListener("click", function() {
      handleImageClick(4);
    });

    let leftArrow = document.getElementById("leftArrow");
    let rightArrow = document.getElementById("rightArrow");
    if (leftArrow !== null) {
      document.getElementById("leftArrow").addEventListener("click", function() {
        handleArrowClick(false);
      });
    }
    if (rightArrow !== null) {
      document.getElementById("rightArrow").addEventListener("click", function() {
        handleArrowClick(true);
      });
    }

  }

  async function handleUpdateSubmit() {
    // Get values from sliders
    const revenueValue = document.getElementById('revenueSlider').value;
    const runtimeValue = document.getElementById('runtimeSlider').value;

    // Get selected values from dropdown menus
    const genreValue = document.getElementById('genreSelect').value;
    //const productionValue = document.getElementById('productionSelect').value;


    // Log the values to the console (you can replace this with any action you need)
    console.log("Revenue Slider Value:", revenueValue);
    console.log("Runtime Slider Value:", runtimeValue);
    console.log("Selected Genre:", genreValue);
    await reloadFilteredData(curCountry, genreValue, revenueValue, runtimeValue);
    l = 0;
    r = 5;
    createD3Visualization(curCountry);


  }



  //when submit button on filters is pressed, update filteredData based on filters
  async function reloadFilteredData(countryName, genre, revenue, runtime) {
    // Load the CSV file
    try {
      const data = await d3.csv("movie_details.csv");

      // Filter data by the selected country
      function filterData(data, country, genre, revenue, runtime) {
        return data.filter(d => {
          // Ensure the string is in a valid JSON format
          const jsonString = d.production_countries.replace(/'/g, "\"");
          const jsonGenre = d.genres.replace(/'/g, "\"");
          const jsonRevenue = d.revenue;
          const jsonRuntime = d.runtime;
          /**let jsonCompany = d.production_companies.replace(/'/g, "\"");
          jsonCompany = jsonCompany.replace(/None/g, "null");
          jsonCompany = jsonCompany.replace(/"name": "([^"]*)"/g, (match, p1) => `"name": "${p1.replace(/"/g, "'")}"`);

          let companyMatch = false;
          try {
            const companies = JSON.parse(jsonCompany);
            let companyMatch = companies.some(companyObj => companyObj.name === company || company == '');
            //console.log(companyMatch);
          } catch (e) {
            //console.log(e);

          }
          if (company == '') {
            companyMatch = true;
          }


          **/
          try {
            // Attempt to parse the production_countries field
            const countries = JSON.parse(jsonString);
            const genres = JSON.parse(jsonGenre);
            let countryMatch = countries.some(countryObj => countryObj.name === country);
            let genreMatch = genres.some(genreObj => genreObj.name === genre || genre == '');
            let revenueMatch = d.revenue >= revenue;
            let runtimeMatch = d.runtime >= runtime;
            //console.log(companyMatch);
            return countryMatch && genreMatch && revenueMatch && runtimeMatch;
          } catch (e) {
            // If parsing fails, log the error and exclude this row from the results
            console.error("Parsing error in row:", d, e);
            return false;
          }

        });
      }

      // Assign the result to a variable or pass it to another function as needed
      filteredData = filterData(data, countryName, genre, revenue, runtime);

    } catch (error) {
      console.error("Error loading CSV:", error);
    }
  }






  function loadInitialData(countryName, resolve) {
    // Load the CSV file
    genreCounts = {};
    productionCompanyCounts = {};
    // let maxRevenue = 0;
    // let maxRuntime = 0;
    d3.csv("movie_details.csv").then(data => {
      // Filter data by the selected country
      function filterDataByCountry(data, country) {
        return data.filter(d => {
          // // Ensure the string is in a valid JSON format
          // if (d.revenue && Number(d.revenue) > maxRevenue) {
          //     maxRevenue = Number(d.revenue);
          // }

          // if (d.runtime && Number(d.runtime) > maxRevenue) {
          //     maxRuntime = Number(d.runtime);
          // }
          
          const jsonString = d.production_countries.replace(/'/g, "\"");
          try {
            // Attempt to parse the production_countries field
            const countries = JSON.parse(jsonString);
            return countries.some(countryObj => countryObj.name === country);
          } catch (e) {
            // If parsing fails, log the error and exclude this row from the results
            console.error("Parsing error in row:", d, e);
            return false;
          }
        });
      }

      // const revenueSlider = document.getElementById('revenueSlider');
      // revenueSlider.max = maxRevenue;
      // revenueSlider.value = maxRevenue / 2;

      // console.log(maxRevenue);
      
      // const runtimeSlider = document.getElementById('runtimeSlider');
      // runtimeSlider.max = maxRuntime;
      // runtimeSlider.value = maxRuntime / 2;

      // console.log(maxRuntime);

      // document.getElementById('revenueSlider').addEventListener('input', function() {
      //     const currentValue = this.value;
      //     document.getElementById('revenueDisplay').innerText = currentValue;
      // });

       
      filteredData = filterDataByCountry(data, countryName);
      console.log(filteredData);
      updateDropdowns();


      //call callback
      if (resolve) {
        resolve();
      }

    });

  }

  function updateDropdowns() {
    // Count occurrences of genres and production companies
    //DECOMPOSE BELOW, THIS MAYBE SHOULD BE CALLED AFTER FILTER UPDATE TOO
    filteredData.forEach(movie => {
      const genres = JSON.parse(movie.genres.replace(/'/g, "\""));
      genres.forEach(genre => {
        if (!genreCounts[genre.name]) {
          genreCounts[genre.name] = 1;
        } else {
          genreCounts[genre.name]++;
        }
      });
      /**  
      try {
        let productionCompaniesString = movie.production_companies.replace(/'/g, "\"");

        // Replace 'None' with null in productionCompaniesString
        productionCompaniesString = productionCompaniesString.replace(/None/g, "null");

        productionCompaniesString = productionCompaniesString.replace(/"name": "([^"]*)"/g, (match, p1) => `"name": "${p1.replace(/"/g, "'")}"`);

        const productionCompanies = JSON.parse(productionCompaniesString);

        productionCompanies.forEach(company => {
          if (!productionCompanyCounts[company.name]) {
            productionCompanyCounts[company.name] = 1;
          } else {
            productionCompanyCounts[company.name]++;
          }
        });
      } catch (e) {
        console.log(e);
      }
      */
    });

    const topGenres = Object.keys(genreCounts).sort((a, b) => genreCounts[b] - genreCounts[a]).slice(0, 10);
    const topCompanies = Object.keys(productionCompanyCounts).sort((a, b) => productionCompanyCounts[b] - productionCompanyCounts[a]).slice(0, 10);

    updateDropdown('genreSelect', topGenres);
    //updateDropdown('productionSelect', topCompanies);
  }

  function updateDropdown(dropdownId, options) {
    const dropdown = document.getElementById(dropdownId);
    dropdown.innerHTML = '';

    // Add a blank entry
    const blankOption = document.createElement('option');
    blankOption.value = ''; // Set the value as needed for your use case
    blankOption.textContent = ''; // Set the display text as needed
    dropdown.appendChild(blankOption);

    // Add the rest of the options
    options.forEach(option => {
      const optionElement = document.createElement('option');
      optionElement.value = option;
      optionElement.textContent = option;
      dropdown.appendChild(optionElement);
    });
  }



  async function createD3Visualization(countryName) {

    // Clear any existing visualization
    const container = d3.select('#main-view');
    container.html('');
    const loadInitialDataPromise = () => new Promise(resolve => {
      if (filteredData == null) {
        // Call loadInitialData with the resolve function as a callback
        console.log('loaded initial');
        loadInitialData(countryName, resolve);
      } else {
        // If data is already available, resolve immediately
        resolve();
      }
    });

    await loadInitialDataPromise();

    if (!eventListenersAdded) {
      addEventListeners();
    }
    eventListenersAdded = true;

    refresh(0, null);

  }


  function refresh(curMovIndex, nextBool) {
    console.log('filtered data', filteredData);
    console.log("refreshed");

    try {
      if (nextBool == null) {
        console.log('top5 populated');
        top5 = filteredData.slice(l, r);
      }
      else if (nextBool == true) {
        l += 5;
        r += 5
        top5 = filteredData.slice(l, r);
      }
      else {
        if ((l - 5) >= 0) {
          l -= 5;
          r -= 5;
          top5 = filteredData.slice(l, r);
        }
      }
    } catch (error) {
      console.error('No movies found');
    }
    console.log('top5', top5);



    try {
      //set title
      const curMov = top5[curMovIndex];
      const titleElem = document.getElementById('title');
      const dateElem = document.getElementById('date');
      const ratingElem = document.getElementById('rating');
      const tagElem = document.getElementById('tagline');
      const overviewElem = document.getElementById('overview');


      //set title
      titleElem.innerHTML = curMov.title;

      //set release date
      dateElem.innerHTML = curMov.release_date;

      //set rating
      ratingElem.innerHTML = curMov.vote_average;

      //set tagline
      tagElem.innerHTML = curMov.tagline;

      //set overview
      overviewElem.innerHTML = curMov.overview;


      let temp = 0;
      temp = top5[prevIndex];
      top5[prevIndex] = top5[curMovIndex];
      top5[curMovIndex] = temp;


      console.log(top5);
      //processing for each top movie

      for (let i = 0; i < 5; i++) {
        const mov = top5[i];
        const dynamicImage = document.getElementById('dynamicImage' + i);

        if (top5.length > 0) {
          console.log(top5);
          //render poster
          if (i < top5.length) {
            dynamicImage.src = 'https://www.themoviedb.org/t/p/original/' + mov.poster_path;
          }
          else {
            dynamicImage.src = '';
            if (document.getElementById("rightArrow") !== null) {
              document.getElementById("rightArrow").remove();
              document.getElementById("next").remove();
            }


          }
        } else {
          console.warn('No data available.');
        }
      }
      //if you click prev
      if (nextBool === false) {
        // Create new elements
        if (document.getElementById('rightArrow') === null) {
          const nextSpan = document.createElement('span');
          nextSpan.id = 'next';
          nextSpan.style.position = 'absolute';
          nextSpan.style.right = '655px';
          nextSpan.style.bottom = '185px';
          nextSpan.style.cursor = 'pointer';
          nextSpan.textContent = 'Next';

          const rightArrow = document.createElement('img');
          rightArrow.id = 'rightArrow';
          rightArrow.src = 'rightArrow.png';
          rightArrow.style.width = '50px';
          rightArrow.style.height = '50px';
          rightArrow.style.position = 'absolute';
          rightArrow.style.right = '680px';
          rightArrow.style.bottom = '170px';
          rightArrow.style.cursor = 'pointer';

          // Append the new elements to the "bottom-row" element
          const bottomRow = document.getElementById('bottom-row');
          bottomRow.appendChild(nextSpan);
          bottomRow.appendChild(rightArrow);

          // Add event listeners to the new elements
          rightArrow.addEventListener("click", function() {
            handleArrowClick(true);
          });
        }

      }
      //if you click next
      if (nextBool === true) {
        if (document.getElementById('leftArrow') === null) {
          // Create new elements
          const prevSpan = document.createElement('span');
          prevSpan.id = 'prev';
          prevSpan.style.position = 'absolute';
          prevSpan.style.right = '770px';
          prevSpan.style.bottom = '185px';
          prevSpan.style.cursor = 'pointer';
          prevSpan.textContent = 'Prev';

          const leftArrow = document.createElement('img');
          leftArrow.id = 'leftArrow';
          leftArrow.src = 'leftArrow.png';
          leftArrow.style.width = '50px';
          leftArrow.style.height = '50px';
          leftArrow.style.position = 'absolute';
          leftArrow.style.right = '720px';
          leftArrow.style.bottom = '170px';
          leftArrow.style.cursor = 'pointer';

          // Append the new elements to the "bottom-row" element
          const bottomRow = document.getElementById('bottom-row');
          bottomRow.appendChild(prevSpan);
          bottomRow.appendChild(leftArrow);

          // Add event listeners to the new elements
          leftArrow.addEventListener("click", function() {
            handleArrowClick(false);
          });
        }


      }
      let leftArrow = document.getElementById("leftArrow");
      let prev = document.getElementById("prev");
      if (l == 0 && leftArrow !== null) {
        leftArrow.remove();
        prev.remove();
        console.log('l=0 remove');
      }


      console.log(l, r);

    } catch (e) {
      console.log("No movies found", e);
      alert('No movies found with the search criteria. Select OK to reload movies');
      filteredData = null;
      top5 = null;
      l = 0;
      r = 5;
      createD3Visualization(curCountry);
      return;



    }
  }



  map.on('click', 'countries', (e) => {
    const coordinates = e.features[0].geometry.coordinates.slice();
    curCountry = e.features[0].properties.name;
    top5 = null;
    eventListenersAdded = false;
    filteredData = null;

    // Create a popup with a container for the D3 visualization
    const popupContent = `
        <div id='d3-container' style='width: 800px; height: 450px; overflow: hidden; background-color: #f8f9fa; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex;'>

<div id="mainView" style='width: 495px; display: flex; flex-direction: column;'>
    <div style='display: flex; flex-direction: row;'>
        <img id="dynamicImage0" src="" style="max-width: 200px; max-height: 250px;">
        <div style='display:flex; flex-direction: column; margin-left: 10px'>
            <div style='display:flex; flex-direction:row;'>
                <h1 style='margin-bottom:-1px; margin-top:-1px' id="title"></h1>
                <span id='date' style='margin-left: 7px;font-size:15px;color:brown;font-family: Garamond, serif;'></span>
            </div>
            <div>
                <img src="rating.png" style="width: 30px; height: auto;">
                <span id="rating" style="position: relative; top:-10px"></span>
            </div>
            <i id='tagline' style='margin-bottom:5px'>
            tagline
            </i>
            <div>
                <h2 style='margin-top: -3px; margin-bottom: 10px'>Overview</h2>
                <div id="overview">overview here</div>
            </div>
        </div>
    </div>

    <div id='bottom-row' style='display: flex; margin-top: auto; justify-content: space-between; margin-bottom: 10px;'>
        <img id="dynamicImage1" src=""  style="max-width: 100px; max-height: 150px; cursor:pointer; box-shadow: 4px 4px 6px rgba(0,0,0,0.3); margin: 0 5px;">
        <img id="dynamicImage2" src=""  style="max-width: 100px; max-height: 150px; cursor:pointer; box-shadow: 4px 4px 6px rgba(0,0,0,0.3); margin: 0 5px;">
        <img id="dynamicImage3" src=""  style="max-width: 100px; max-height: 150px; cursor:pointer; box-shadow: 4px 4px 6px rgba(0,0,0,0.3); margin: 0 5px;">
        <img id="dynamicImage4" src=""  style="max-width: 100px; max-height: 150px; cursor:pointer; box-shadow: 4px 4px 6px rgba(0,0,0,0.3); margin: 0 5px;">

        <span id="next" style="position:absolute; right: 655px; bottom: 185px;cursor:pointer">Next</span>
        <img id="rightArrow" src="rightArrow.png" style="width:50px; height:50px; position:absolute; right:680px; bottom: 170px;cursor:pointer">
    </div>
</div>

<div style='width: 5px; background-color: white;'></div> <!-- White space margin -->


<div style='width: 300px; padding: 10px; border-left: 1px solid #ddd;'>
    <h3 style='margin-bottom: 15px;'>Filters</h3>
     <label for="revenueSlider" style="margin-bottom: 0;">Revenue</label>
 <div style="display: flex; align-items: center; gap: 10px;">
   
    <span>0</span>
    <input type="range" id="revenueSlider" name="revenue" min="0" max="1000000000" value="500000000" style="flex-grow: 1; margin: 0;">
    <span>1B</span>
</div>
<label for="runtimeSlider" style="margin-bottom: 0;">Run Time</label>
           <div style="display: flex; align-items: center; gap: 10px;">
    
    <span>0</span>
    <input type="range" id="runtimeSlider" name="runtime" min="0" max="300" value="120" style="flex-grow: 1; margin: 0;">
    <span>300 min</span>
</div>


            <label for="genreSelect" style='display:block; margin-bottom: 5px;'>Genre</label>
            <select id="genreSelect" name="genre" style='width: 100%; padding: 5px; margin-bottom: 20px;'>


            </select>



            <button class="update-button" style="width:120px; height:40px; color: white; background-color: #009DD1; border-radius: 20px; ">Update Filters</button>

</div>

</div>
        `;
    /** PRODUCTION OPTION
    <label for="productionSelect" style='display:block; margin-bottom: 5px;'>Production Company</label>
    <select id="productionSelect" name="prodComp" style='width: 100%; padding: 5px; margin-bottom: 20px;'>

    </select>
    */
    new mapboxgl.Popup({ offset: 25 })
      .setLngLat(coordinates)
      .setHTML(popupContent)
      .addTo(map);

    document.querySelector('.update-button').addEventListener('click', handleUpdateSubmit);

    // Call the function to create the D3 visualization

    l = 0;
    r = 5;
    createD3Visualization(curCountry);
  });
});
